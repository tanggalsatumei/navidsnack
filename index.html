<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Navid Snack — Camilan Sehat & Lezat Lamongan</title>
<meta name="description" content="Navid Snack - Camilan sehat & lezat dari Lamongan. Pesan cepat via WhatsApp. Halal, higienis, bergizi."/>
<meta name="keywords" content="navid snack, camilan lamongan, keripik pisang, kacang gurih, snack sehat"/>
<link rel="icon" href="assets/logo.png" type="image/png"/>
<style>
:root{
  --bg:#fff;--surface:#fbfaf8;--muted:#7b7b7b;--text:#17202a;
  --brand:#0f1724;--accent:#ffb703;--accent-2:#fb8500;--soft:#f4f1ea;
  --success:#2d6a4f;--danger:#d00000;--glass:rgba(255,255,255,0.7);
  --radius:12px;--shadow:0 8px 24px rgba(17,24,39,0.08);--maxw:1200px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;line-height:1.45;
}

/* Dark mode overrides (toggle class on body) */
body.dark-mode{
  --bg:#071021;--surface:#0f1724;--muted:#9aa6b2;--text:#e6eef4;
  --brand:#071127;--accent:#ffb703;--accent-2:#ff9f1c;--soft:#081226;
}
body.dark-mode .btn{color:#071021;background:var(--accent)}
body.dark-mode .price-new{color:var(--accent)}
body.dark-mode .slide-text h1{color:#fff}


/* Header */
header{position:sticky;top:0;z-index:1200;background:linear-gradient(180deg,var(--brand),#0b1220);color:var(--accent);padding:12px 20px;display:flex;align-items:center;gap:16px;box-shadow:0 2px 8px rgba(2,6,23,0.15)}
.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:18px}
.logo img{width:36px;height:36px;border-radius:8px;background:var(--soft);padding:4px}
nav{margin-left:auto;display:flex;align-items:center;gap:16px}
nav ul{display:flex;gap:16px;margin:0;padding:0;list-style:none}
nav a{color:var(--accent);text-decoration:none;font-weight:600}
.menu-toggle{
  display:none;
  background:none;
  border:1px solid rgba(255,183,3,0.12);
  color:var(--accent);
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
  font-size:22px; /* Tambahan */
}
@media(max-width:900px){
  .menu-toggle{display:inline-block}
}

.btn-toggle{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--accent);padding:8px 10px;border-radius:10px;cursor:pointer}

/* Side menu (mobile) */
.side-menu{position:fixed;top:0;left:-100%;width:78%;height:100%;background:var(--brand);color:var(--accent);padding:22px;transition:left .28s;z-index:1300;overflow:auto}
.side-menu.active{left:0}
.side-menu .close-btn{background:none;border:none;color:var(--accent);font-size:28px;position:absolute;top:12px;right:18px;cursor:pointer}
.side-menu ul{list-style:none;padding:40px 0 0 0;margin:0}
.side-menu li{margin:14px 0}

/* hero */
#hero{position:relative;height:70vh;min-height:360px;overflow:hidden;border-bottom:1px solid rgba(15,23,36,0.06)}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .6s}
.slide.active{opacity:1}
.slide::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.35),rgba(2,6,23,0.12))}
.slide-content{position:relative;z-index:2;max-width:var(--maxw);margin:0 auto;padding:28px;color:var(--accent);display:flex;gap:24px;align-items:center;justify-content:center}
.slide-text h1{margin:0;font-size:34px;color:#fff}
@media(max-width:600px){
  .slide-text h1{font-size:22px}
  .slide-text p{font-size:14px}
}

.btn{background:var(--accent);color:var(--brand);border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(251,133,0,0.12)}
.dots{position:absolute;bottom:18px;width:100%;text-align:center;z-index:3}
.dot{display:inline-block;width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.6);margin:0 6px;cursor:pointer;opacity:.7}
.dot.active{background:var(--accent-2);opacity:1}
.arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.35);border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:20px}
.arrow-left{left:18px}.arrow-right{right:18px}

/* layout & cards */
.container{max-width:var(--maxw);margin:0 auto;padding:28px}
.section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px}
.card{background:var(--surface);padding:14px;border-radius:12px;box-shadow:var(--shadow);position:relative;overflow:visible;border:1px solid rgba(2,6,23,0.04)}
.img-wrapper{position:relative;border-radius:10px;overflow:hidden}
.card img{display:block;width:100%;height:220px;object-fit:cover;cursor:pointer}
.promo-label{position:absolute;top:12px;left:12px;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#fff;padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px;z-index:5}
.countdown-overlay{position:absolute;left:0;right:0;bottom:0;background:rgba(255,183,3,0.95);color:#071123;padding:6px 8px;border-bottom-left-radius:10px;border-bottom-right-radius:10px;font-weight:700;font-size:13px;text-align:center;z-index:6}
.price-row{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0}
.price-old{text-decoration:line-through;color:var(--muted);font-size:13px}
.price-new{color:var(--danger);font-weight:800}
.stars{color:#f6c453;margin-bottom:8px}

/* gallery */
.gallery-grid{
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  gap:14px;
  padding-bottom:10px;
}
.gallery-card{flex:0 0 180px;scroll-snap-align:start;}
.gallery-card img{width:100%;height:240px;object-fit:cover;display:block;transition:transform .25s}
.gallery-card:hover img{transform:scale(1.05)}

/* lightbox */
.lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,0.85);z-index:1400}
.lightbox img{max-width:92%;max-height:86%;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.6)}
.lightbox .close-light{position:absolute;top:18px;right:28px;color:#fff;font-size:28px;cursor:pointer}
.lightbox .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:none;border:none;color:#fff;font-size:40px;padding:8px;cursor:pointer}
.lightbox .prev{left:12px}.lightbox .next{right:12px}

/* testimonial */
.testimonial-wrap{overflow:hidden;position:relative}
.testimonial-slider{display:flex;transition:transform .5s ease;gap:20px}
.testimonial-card{min-width:260px}
.testimonial-card img{width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:12px}

/* cart & floats */
.whatsapp-float{position:fixed;bottom:18px;right:18px;z-index:1300}
.whatsapp-float a img{width:56px;height:56px;border-radius:12px;box-shadow:0 8px 22px rgba(11,18,32,0.15)}
/* floating cart hidden by default; shown when user adds item */
.floating-cart{position:fixed;bottom:86px;right:26px;z-index:1301;background:var(--accent);width:56px;height:56px;border-radius:14px;display:none;align-items:center;justify-content:center;font-weight:800;color:var(--brand);cursor:pointer;box-shadow:0 10px 30px rgba(15,23,36,0.12)}
.cart-badge{position:absolute;top:-8px;right:-8px;background:var(--danger);color:#fff;padding:4px 7px;border-radius:999px;font-size:12px}
.cart-panel{position:fixed;top:0;right:-420px;width:380px;height:100%;background:var(--bg);box-shadow:-20px 0 40px rgba(2,6,23,0.12);transition:right .35s;padding:20px;z-index:1350;overflow:auto}
.cart-panel.active{right:0}
.close-cart{position:absolute;top:12px;right:16px;font-size:22px;cursor:pointer}

/* quick order */
.quick-order{display:flex;flex-direction:column;gap:10px;padding:14px;background:var(--surface);border-radius:12px;box-shadow:var(--shadow)}
.quick-order input,.quick-order textarea,.quick-order select{padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);font-size:14px}
.quick-order button{align-self:flex-start}

  .feed-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
.feed-ig, .feed-yt{
  background:var(--surface);
  padding:16px;
  border-radius:12px;
  box-shadow:var(--shadow);
}
#igEmbedContainer blockquote.instagram-media{
  width:100%!important;max-width:100%!important;
}
.yt-wrapper iframe{
  width:100%;height:315px;
  border-radius:12px;
}
@media(max-width:800px){
  .feed-grid{grid-template-columns:1fr}
}


/* footer */
footer{background:#08101a;color:#fff;padding:28px 20px;margin-top:40px}
.footer-grid{display:flex;gap:20px;flex-wrap:wrap;max-width:var(--maxw);margin:0 auto}
.footer-info{flex:1 1 320px}
.footer-map{flex:1 1 320px}

/* misc */
.promo-marquee{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#071123;padding:8px;text-align:center;font-weight:800}
.toast{position:fixed;left:18px;bottom:26px;background:rgba(3,7,18,0.95);color:#fff;padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);z-index:1450;display:flex;gap:10px;align-items:center}
.scroll-top{position:fixed;right:18px;bottom:160px;background:transparent;border:1px solid rgba(2,6,23,0.06);padding:8px;border-radius:10px;cursor:pointer;display:none;z-index:1302}

@media(max-width:900px){
  .slide-content{flex-direction:column;text-align:center}
  .slide-content img{width:160px;height:160px}
  .menu-toggle{display:inline-block}
  nav ul{display:none}
}
</style>
</head>
<body>
<!-- promo -->
<div class="promo-marquee" id="promoBar"><marquee behavior="scroll" direction="left">🔥 FLASH SALE Hari ini — Tersisa 3 item lagi! 🔥</marquee></div>

<!-- header -->
<header>
  <button class="menu-toggle" onclick="toggleMenu()" aria-label="Buka menu">☰</button>
  <div class="logo"><img src="assets/logo.png" alt="Navid Snack logo"/><span>Navid Snack</span></div>
  <nav>
    <ul>
      <li><a href="#hero">Beranda</a></li>
      <li><a href="#products">Produk</a></li>
      <li><a href="#gallery">Galeri</a></li>
      <li><a href="#testimonials">Testimoni</a></li>
      <li><a href="#feed">Feed</a></li>
      <li><a href="#contact">Kontak</a></li>
    </ul>
  </nav>
  <button class="btn-toggle" onclick="toggleDarkMode()" aria-pressed="false" title="Toggle dark mode">🌙</button>
</header>

<!-- side menu -->
<div id="sideMenu" class="side-menu" aria-hidden="true">
  <button class="close-btn" onclick="toggleMenu()" aria-label="Tutup">×</button>
  <ul>
    <li><a href="#hero" onclick="toggleMenu()">Beranda</a></li>
    <li><a href="#products" onclick="toggleMenu()">Produk</a></li>
    <li><a href="#gallery" onclick="toggleMenu()">Galeri</a></li>
    <li><a href="#testimonials" onclick="toggleMenu()">Testimoni</a></li>
    <li><a href="#feed" onclick="toggleMenu()">Feed</a></li>
    <li><a href="#contact" onclick="toggleMenu()">Kontak</a></li>
  </ul>
</div>

<!-- HERO -->
<section id="hero">
  <button class="arrow arrow-left" onclick="prevSlide()" aria-label="Sebelumnya">❮</button>
  <button class="arrow arrow-right" onclick="nextSlide()" aria-label="Berikutnya">❯</button>
  <!-- Slides akan diinject dari data.js -->
</section>

<!-- PRODUCTS -->
<section id="products" class="container" aria-labelledby="productsTitle">
  <div class="section-title"><h2 id="productsTitle">Produk Unggulan</h2></div>
  <div class="products-grid" id="productsGrid"></div>
</section>

<!-- GALLERY -->
<section id="gallery" class="container" aria-labelledby="galleryTitle">
  <div class="section-title"><h2 id="galleryTitle">Galeri Produk</h2></div>
  <div class="gallery-grid" id="galleryGrid"></div>
</section>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
  <button class="nav-btn prev" onclick="prevGallery()" aria-label="Sebelumnya">❮</button>
  <img id="lightboxImg" alt="Preview"/>
  <button class="nav-btn next" onclick="nextGallery()" aria-label="Berikutnya">❯</button>
  <button class="close-light" onclick="closeLightbox()" aria-label="Tutup">×</button>
</div>

<!-- TESTIMONIAL -->
<section id="testimonials" class="container" aria-labelledby="testiTitle">
  <div class="section-title"><h2 id="testiTitle">Testimoni Pelanggan</h2></div>
  <div class="testimonial-wrap">
    <div style="overflow:hidden">
      <div id="testiSlider" class="testimonial-slider"></div>
    </div>
    <div class="testimonial-nav" style="margin-top:12px">
      <button class="btn" onclick="testiPrev()">❮</button>
      <button class="btn" onclick="testiNext()">❯</button>
    </div>
  </div>
</section>

<!-- QUICK ORDER FORM -->
<section class="container" aria-labelledby="quickOrderTitle" style="margin-top:18px">
  <div class="section-title"><h2 id="quickOrderTitle">Form Pemesanan Cepat</h2></div>
  <form id="quickOrderForm" class="quick-order" onsubmit="submitQuickOrder(event)">
    <input id="qName" type="text" placeholder="Nama lengkap" required aria-label="Nama"/>
    <input id="qWA" type="tel" placeholder="Nomor WhatsApp (contoh: 0812...)" required aria-label="Nomor WA"/>
    <input id="qAddr" type="text" placeholder="Alamat (kelurahan/kota)" required aria-label="Alamat"/>
    <select id="qProduct" required aria-label="Pilih produk">
      <option value="">Pilih produk...</option>
    </select>
    <input id="qQty" type="number" min="1" value="1" required aria-label="Jumlah"/>
    <textarea id="qNote" rows="2" placeholder="Catatan / request (opsional)"></textarea>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="btn" type="submit">Kirim ke WhatsApp Admin</button>
      <small style="color:var(--muted)">Subtotal akan disertakan sebelum ongkir</small>
    </div>
  </form>
</section>

<!-- floating elements -->
<button class="floating-cart" id="floatingCart" onclick="toggleCart()" aria-label="Buka keranjang">🛒<span class="cart-badge" id="cartBadge">0</span></button>
<div class="whatsapp-float" title="Chat via WhatsApp"><a id="waLink" href="https://wa.me/6281234567890" target="_blank" rel="noreferrer"><img src="https://img.icons8.com/color/96/whatsapp.png" alt="WhatsApp Navid Snack"/></a></div>
<button class="scroll-top" id="scrollTopBtn" onclick="scrollToTop()" aria-label="Kembali ke atas">↑</button>

<!-- cart panel -->
<aside id="cartPanel" class="cart-panel" aria-label="Keranjang belanja">
  <button class="close-cart" onclick="toggleCart()">×</button>
  <h3>Keranjang</h3>
  <div id="cartItems" style="margin-top:14px"></div>
  <p style="margin-top:12px"><strong>Subtotal:</strong> Rp <span id="cartTotal">0</span></p>
  <p style="font-size:13px;color:var(--muted)">Belum termasuk ongkir dari Deket, Lamongan</p>
  <div style="display:flex;gap:8px;margin-top:12px">
    <button class="btn" onclick="checkout()">Checkout via WhatsApp</button>
    <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="clearCart()">Bersihkan</button>
  </div>
</aside>

<!-- product modal -->
<div id="productModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1500">
  <div style="background:var(--bg);padding:18px;border-radius:10px;max-width:520px;width:calc(100% - 40px);position:relative">
    <button onclick="closeProductModal()" style="position:absolute;top:10px;right:12px;background:none;border:none;font-size:22px;cursor:pointer">×</button>
    <img id="modalImg" src="" alt="Detail produk" style="width:100%;height:300px;object-fit:cover;border-radius:8px;margin-bottom:10px">
    <h3 id="modalName"></h3>
    <p id="modalDesc" style="color:var(--muted)"></p>
    <p id="modalPrice" style="font-weight:800;color:var(--danger)"></p>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" onclick="addToCartFromModal()">Tambah ke Keranjang</button>
      <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="closeProductModal()">Tutup</button>
    </div>
  </div>
</div>

<!-- feed -->
<section id="feed" class="container" aria-labelledby="feedTitle">
  <div class="section-title"><h2 id="feedTitle">Media Sosial</h2></div>
  <div class="feed-grid">
    <div class="feed-ig"><h3>Instagram</h3><div id="igEmbedContainer"></div></div>
    <div class="feed-yt">
      <h3>YouTube</h3>
      <div class="yt-wrapper">
        <iframe src="https://www.youtube.com/embed/GIGHFb40bps?list=RDGIGHFb40bps" title="Navid Snack YouTube" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
  </div>
</section>

<!-- footer -->
<footer id="contact">
  <div class="footer-grid">
    <div class="footer-info">
      <h3>Navid Snack</h3>
      <p>Alamat: Deket, Lamongan, Jawa Timur</p>
      <p>Telp: +62 812-3456-7890</p>
      <p style="margin-top:8px"><strong>Certificate:</strong></p>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px" id="certWrap"></div>
    </div>
    <div class="footer-map">
      <h4>Lokasi</h4>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!..." style="width:100%;height:220px;border:0;border-radius:10px" loading="lazy"></iframe>
    </div>
  </div>
</footer>

<div id="toastPlace"></div>
<script async defer src="//www.instagram.com/embed.js"></script>
<script src="js/data.js"></script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  document.title = window.SITE.brand + " — " + window.SITE.description;

  document.querySelector('meta[name="description"]')
    ?.setAttribute('content', window.SITE.description);
  document.querySelector('meta[name="keywords"]')
    ?.setAttribute('content', window.SITE.keywords);

  // OG TAGS (SEO Sosmed)
  const head=document.head;
  const ogs = [
    ['og:title', window.SITE.brand],
    ['og:description', window.SITE.description],
    ['og:image', window.SITE.img],
    ['og:url', window.SITE.url]
  ];
  ogs.forEach(([p,c])=>{
    const m=document.createElement('meta');
    m.setAttribute('property',p); m.setAttribute('content',c);
    head.appendChild(m);
  });

  // Teks promo
  const promo = $('#promoBar marquee');
  if (promo) promo.textContent = window.PROMO_TEXT;
});
</script>
<script>
/* =======================
   UTILITAS & SELECTOR
======================= */
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));

/* =======================
   RENDER DINAMIS
======================= */
document.addEventListener('DOMContentLoaded', ()=>{
  const promo = $('#promoBar marquee');
  if (promo) promo.textContent = window.PROMO_TEXT;
});


function renderHero(){
  const hero = $('#hero');
  window.SLIDES.forEach((s,i)=>{
    hero.insertAdjacentHTML('beforeend',`
      <div class="slide ${i===0?'active':''}" style="background-image:url('${s.bg}')">
        <div class="slide-content">
          <img src="${s.img}" alt="${s.title}">
          <div class="slide-text">
            <h1>${s.title}</h1>
            <p>${s.text}</p>
            <a href="${s.cta.link}" class="btn">${s.cta.text}</a>
          </div>
        </div>
      </div>
    `);
  });
  const dots = document.createElement('div'); dots.className='dots';
  window.SLIDES.forEach((_,i)=>dots.innerHTML+=`<span class="dot ${i===0?'active':''}" onclick="showSlide(${i})"></span>`);
  hero.appendChild(dots);
}

function renderProducts(){
  // contoh di renderProducts()
  <img src="${p.img}" alt="${p.name}" loading="lazy" onclick="openProductModal(this)">

  const grid = $('#productsGrid');
  grid.innerHTML = '';
  const qSelect = $('#qProduct');
  qSelect.innerHTML = '<option value="">Pilih produk...</option>';
  window.PRODUCTS.forEach(p=>{
    grid.innerHTML += `
      <article class="card" data-name="${p.name}" data-price="${p.price}" data-oldprice="${p.oldPrice||''}"
        data-stock="${p.stock}" data-promo="${p.promo}" data-desc="${p.desc}" data-img="${p.img}">
        <div class="img-wrapper">
          <img src="${p.img}" alt="${p.name}" onclick="openProductModal(this)">
          ${p.promo ? `<div class="promo-label">PROMO</div><div class="countdown-overlay" data-cid>Promo terbatas</div>` : ''}
        </div>
        <h3>${p.name}</h3>
        <div class="price-row">
          <span class="price-old">${p.oldPrice ? 'Rp '+p.oldPrice.toLocaleString('id-ID') : ''}</span>
          <span class="price-new">Rp ${p.price.toLocaleString('id-ID')}</span>
        </div>
        <div class="stars">${'★'.repeat(p.rating||5)}</div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
          <button class="btn" onclick="addToCart(this)">Tambah ke Keranjang</button>
          <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--brand)" onclick="quickOrderPref('${p.name}',${p.price})">Pesan Cepat</button>
        </div>
      </article>`;
    qSelect.innerHTML += `<option value="${p.name}|${p.price}">${p.name} - Rp${p.price.toLocaleString('id-ID')}</option>`;
  });
}

function renderGallery(){
  const grid = $('#galleryGrid');
  grid.innerHTML='';
  window.GALLERY.forEach((g,i)=>{
    grid.innerHTML+=`<div class="gallery-card"><img src="${g.src}" alt="${g.alt}" onclick="openLightboxByIndex(${i})"></div>`;
  });
  window.galleryImgs = window.GALLERY.map(g=>g.src);
}

function renderTestimonials(){
  const slider = $('#testiSlider');
  slider.innerHTML='';
  window.TESTIMONIALS.forEach(t=>{
    slider.innerHTML += `<div class="testimonial-card"><img src="${t.img}" alt="${t.name}"><p><strong>${t.name}, ${t.kota}</strong></p><p>"${t.text}"</p></div>`;
  });
}

function renderCertificates(){
  const wrap = $('#certWrap');
  window.SITE.sertifikat.forEach(s=>{
    wrap.innerHTML+=`<img src="${s.src}" alt="${s.alt}" style="height:40px;border-radius:6px">`;
  });
}

function initNotif(){
  setInterval(()=>{
    const s = window.NOTIFIKASI[Math.floor(Math.random()*window.NOTIFIKASI.length)];
    showToast(`${s.nama} dari ${s.kota} baru saja membeli ${s.produk}`);
  },14000);
}

function initCountdown(){
  const now = new Date();
  $$('.card').forEach(card=>{
    if(card.dataset.promo==='true'){
      const start = card.dataset.tglpromostart && new Date(card.dataset.tglpromostart+'T'+(card.dataset.jampromostart||'00:00'));
      const end   = card.dataset.tglpromoend && new Date(card.dataset.tglpromoend+'T'+(card.dataset.jampromoend||'23:59'));
      const cEl = card.querySelector('[data-cid]');
      if(start && end && now>=start && now<=end){
        const tick=()=>{
          const now=new Date(), diff=end-now;
          if(diff<=0){cEl.textContent='Promo berakhir'; return;}
          const h=Math.floor(diff/1000/60/60), m=Math.floor(diff/1000/60)%60, s=Math.floor(diff/1000)%60;
          cEl.textContent=`Sisa ${h}j ${m}m ${s}d`;
        };
        setInterval(tick,1000); tick();
      }else{
        cEl.textContent='Promo terbatas';
      }
    }
  });
}


/* =======================
   SLIDER CONTROL
======================= */
let slideCur=0;
function showSlide(n){
  const slides=$$('.slide'), dots=$$('.dot');
  slideCur=(n+slides.length)%slides.length;
  slides.forEach((s,i)=>s.classList.toggle('active',i===slideCur));
  dots.forEach((d,i)=>d.classList.toggle('active',i===slideCur));
}
function nextSlide(){showSlide(slideCur+1)}
function prevSlide(){showSlide(slideCur-1)}

/* =======================
   FUNGSI LAMA
======================= */
function toggleMenu(){ const m=$('#sideMenu'); const a=m.classList.toggle('active'); m.setAttribute('aria-hidden',!a); }
document.addEventListener('click',e=>{ const side=$('#sideMenu'); if(!e.target.closest('.menu-toggle') && side.classList.contains('active') && !e.target.closest('.side-menu')){ side.classList.remove('active'); side.setAttribute('aria-hidden','true'); }});
function toggleDarkMode(){
  const dark = document.body.classList.toggle('dark-mode');
  localStorage.setItem('dark', dark ? '1' : '0');
  const t=dark?'☀️':'🌙';
  $$('.btn-toggle').forEach(b=>b.textContent=t);
}
// saat load
if(localStorage.getItem('dark')==='1'){
  document.body.classList.add('dark-mode');
}

function initProductCards(){
  $$('.card').forEach(card=>{
    const promo = card.dataset.promo==='true';
    const oldEl = card.querySelector('.price-old');
    if(!promo && oldEl) oldEl.style.display='none';
  });
}

function formatRupiah(v){ return 'Rp ' + Number(v).toLocaleString('id-ID'); }

/* CART */
let cart=[];
const floatingCartBtn=$('#floatingCart'),cartBadge=$('#cartBadge'),cartItemsWrap=$('#cartItems'),cartTotalEl=$('#cartTotal');
function addToCart(btn){ addProductToCartFromCard(btn.closest('.card')); }
function addProductToCartFromCard(card){
  const name=card.dataset.name, price=Number(card.dataset.price), stock=Number(card.dataset.stock||999);
  let f=cart.find(x=>x.name===name);
  if(f){ if(f.qty+1>stock){ showToast('Stok tidak cukup untuk '+name); return; } f.qty++; }
  else cart.push({name,price,qty:1,stock});
  renderCart(); showToast(name+' ditambahkan ke keranjang'); floatingCartBtn.style.display='flex';
}
function addToCartFromModal(){
  const name=$('#modalName').textContent;
  const price=Number($('#modalPrice').getAttribute('data-price')||0);
  let f=cart.find(x=>x.name===name);
  if(f) f.qty++; else cart.push({name,price,qty:1,stock:99});
  renderCart(); showToast(name+' ditambahkan ke keranjang'); floatingCartBtn.style.display='flex'; closeProductModal();
}
function renderCart(){
  localStorage.setItem('cart', JSON.stringify(cart));
  cartItemsWrap.innerHTML=''; let total=0;
  cart.forEach((it,i)=>{ total+=it.price*it.qty;
    cartItemsWrap.innerHTML+=`
      <div class="cart-item" style="padding:10px 0">
        <strong>${it.name}</strong><div style="margin-top:6px">Rp ${it.price.toLocaleString('id-ID')} 
        <button onclick="decQty(${i})">-</button>
        <input type="number" value="${it.qty}" min="1" style="width:56px" onchange="setQty(${i}, this.value)">
        <button onclick="incQty(${i})">+</button> = <strong>Rp ${(it.price*it.qty).toLocaleString('id-ID')}</strong>
        <button style="float:right;background:transparent;border:none;color:var(--danger)" onclick="removeItem(${i})">Hapus</button>
        </div></div>`;
  });
  document.addEventListener('DOMContentLoaded',()=>{
  cart = JSON.parse(localStorage.getItem('cart')||'[]');
  cartTotalEl.textContent=total.toLocaleString('id-ID');
  cartBadge.textContent=cart.reduce((s,i)=>s+i.qty,0);
  });
}
function incQty(i){ if(cart[i].qty<cart[i].stock) cart[i].qty++; renderCart(); }
function decQty(i){ if(cart[i].qty>1) cart[i].qty--; renderCart(); }
function setQty(i,v){ let q=Number(v); if(isNaN(q)||q<1) q=1; if(q>cart[i].stock){ showToast('Melebihi stok tersedia'); q=cart[i].stock; } cart[i].qty=q; renderCart(); }
function removeItem(i){ cart.splice(i,1); renderCart(); if(!cart.length) floatingCartBtn.style.display='none'; }
function clearCart(){ cart=[]; renderCart(); toggleCart(); showToast('Keranjang dibersihkan'); floatingCartBtn.style.display='none'; }
function toggleCart(){ $('#cartPanel').classList.toggle('active'); }

/* CHECKOUT WA */
function checkout(){
  if(!cart.length){ showToast('Keranjang kosong'); return; }
  let msg='Halo, saya ingin pesan:%0A'; let sub=0;
  cart.forEach(it=>{ msg+=`${it.name} x ${it.qty} = Rp ${(it.price*it.qty).toLocaleString('id-ID')}%0A`; sub+=it.price*it.qty; });
  msg+=`%0ASubtotal: Rp ${sub.toLocaleString('id-ID')} (belum termasuk ongkir dari Deket, Lamongan)`;
  window.open('https://wa.me/'+window.SITE.wa+'?text='+encodeURIComponent(msg));
}

/* QUICK ORDER */
function quickOrderPref(n,p){ $('#qProduct').value=`${n}|${p}`; $('#qQty').value=1; $('#qName').focus(); window.scrollTo({top:$('#quickOrderForm').offsetTop-80,behavior:'smooth'});}
function submitQuickOrder(e){
  e.preventDefault();
  const n=$('#qName').value.trim(),wa=$('#qWA').value.trim(),addr=$('#qAddr').value.trim();
  const prod=$('#qProduct').value,qty=Number($('#qQty').value),note=$('#qNote').value;
  if(!prod){showToast('Pilih produk');return;}
  const [pn,pp]=prod.split('|'); const sub=Number(pp)*qty;
  const txt=`Halo, saya *${n}* ingin memesan:%0A- ${pn} x ${qty} = Rp ${sub}%0AAlamat: ${addr}%0ANo WA: ${wa}%0ANote: ${note||'-'}%0A(Subtotal belum termasuk ongkir dari Deket, Lamongan)`;
  window.open('https://wa.me/'+window.SITE.wa+'?text='+encodeURIComponent(txt));
}

/* TOAST */
function showToast(text,delay=4000){
  const t=document.createElement('div'); t.className='toast'; t.innerHTML=`<div>${text}</div>`;
  $('#toastPlace').appendChild(t);
  setTimeout(()=>{t.style.transition='opacity .5s';t.style.opacity=0;t.addEventListener('transitionend',()=>t.remove());},delay);
}

/* LIGHTBOX & MODAL */
function openLightboxByIndex(i){ window.gIndex=i; $('#lightboxImg').src=window.galleryImgs[i]; $('#lightbox').style.display='flex'; $('#lightbox').setAttribute('aria-hidden','false'); }
function closeLightbox(){ $('#lightbox').style.display='none'; $('#lightbox').setAttribute('aria-hidden','true'); }
function nextGallery(){ window.gIndex=(window.gIndex+1)%window.galleryImgs.length; $('#lightboxImg').src=window.galleryImgs[window.gIndex]; }
function prevGallery(){ window.gIndex=(window.gIndex-1+window.galleryImgs.length)%window.galleryImgs.length; $('#lightboxImg').src=window.galleryImgs[window.gIndex]; }

function openProductModal(img){
  const c=img.closest('.card'); $('#modalImg').src=c.dataset.img;
  $('#modalName').textContent=c.dataset.name; $('#modalDesc').textContent=c.dataset.desc;
  $('#modalPrice').textContent=formatRupiah(c.dataset.price); $('#modalPrice').setAttribute('data-price',c.dataset.price);
  $('#productModal').style.display='flex';
}
function closeProductModal(){ $('#productModal').style.display='none'; }

/* TESTIMONI SLIDER */
let tIdx=0; const tSlider=()=>$('#testiSlider');
function testiNext(){ tIdx=(tIdx+1)%tSlider().children.length; tSlider().style.transform=`translateX(-${tIdx*260}px)`;}
function testiPrev(){ tIdx=(tIdx-1+tSlider().children.length)%tSlider().children.length; tSlider().style.transform=`translateX(-${tIdx*260}px)`;}

/* SCROLL TOP */
function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}); }
window.addEventListener('scroll',()=>$('#scrollTopBtn').style.display=(window.scrollY>200)?'inline-block':'none');
function enableSwipe(container, callback){
  let startX=0;
  container.addEventListener('touchstart',e=>{startX=e.touches[0].clientX});
  container.addEventListener('touchend',e=>{
    const dx=e.changedTouches[0].clientX-startX;
    if(Math.abs(dx)>50) callback(dx<0?'next':'prev');
  });
}
enableSwipe($('#testiSlider'), dir=> dir==='next'?testiNext():testiPrev());
enableSwipe($('#galleryGrid'), dir=>{
  $('#galleryGrid').scrollBy({left: dir==='next'?250:-250, behavior:'smooth'});
});


/* =======================
   INIT
======================= */
document.addEventListener('DOMContentLoaded',()=>{
  renderHero();renderProducts();renderGallery();renderTestimonials();renderCertificates();
  initProductCards();renderCart();initNotif();
  if(!cart.length) $('#floatingCart').style.display='none';
  setInterval(nextSlide,6000);
});
</script>

</body>
</html>
