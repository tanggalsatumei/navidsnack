<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="pageTitle">Navid Snack — Camilan Sehat & Lezat Lamongan</title>
<meta name="description" id="metaDescription" content="Navid Snack - Camilan sehat & lezat dari Lamongan. Pesan cepat via WhatsApp. Halal, higienis, bergizi."/>
<meta name="keywords" id="metaKeywords" content="navid snack, camilan lamongan, keripik pisang, kacang gurih, snack sehat"/>

<!-- Open Graph (akan diupdate ke nilai dari data.js setelah data.js dimuat) -->
<meta property="og:title" content="" id="ogTitle"/>
<meta property="og:description" content="" id="ogDesc"/>
<meta property="og:image" content="" id="ogImage"/>
<meta property="og:type" content="website"/>

<link rel="icon" id="favicon" href="assets/logo.png" type="image/png"/>

<style>
:root{
  --bg:#fff;--surface:#fbfaf8;--muted:#7b7b7b;--text:#17202a;
  --brand:#0f1724;--accent:#ffb703;--accent-2:#fb8500;--soft:#f4f1ea;
  --success:#2d6a4f;--danger:#d00000;--glass:rgba(255,255,255,0.7);
  --radius:12px;--shadow:0 8px 24px rgba(17,24,39,0.08);--maxw:1200px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;line-height:1.45;
}

/* Dark mode overrides (toggle class on body) */
body.dark-mode{
  --bg:#071021;--surface:#0f1724;--muted:#9aa6b2;--text:#e6eef4;
  --brand:#071127;--accent:#ffb703;--accent-2:#ff9f1c;--soft:#081226;
}

body.dark-mode .card h3,
body.dark-mode .price-new,
body.dark-mode .price-old,
body.dark-mode .stars {
  color: var(--text);
}

  .promo-marquee {
  background: linear-gradient(90deg, #ff0044, #ff9900);
  color: #fff;
  font-weight: 800;
  padding: 10px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  font-size: 1.1rem;
  letter-spacing: 0.5px;
}


/* Header */
header{position:sticky;top:0;z-index:1200;background:linear-gradient(180deg,var(--brand),#0b1220);color:var(--accent);padding:12px 20px;display:flex;align-items:center;gap:16px;box-shadow:0 2px 8px rgba(2,6,23,0.15)}
.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:18px}
.logo img{width:36px;height:36px;border-radius:8px;background:var(--soft);padding:4px}
nav{margin-left:auto;display:flex;align-items:center;gap:16px}
nav ul{display:flex;gap:16px;margin:0;padding:0;list-style:none}
nav a{color:var(--accent);text-decoration:none;font-weight:600}
.menu-toggle{display:none;background:none;border:1px solid rgba(255,183,3,0.12);color:var(--accent);padding:8px;border-radius:8px;cursor:pointer}
.btn-toggle{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--accent);padding:8px 10px;border-radius:10px;cursor:pointer}

/* Side menu (mobile) */
.side-menu {
  position: fixed;
  top: 0;
  left: -100%;
  width: 80%;
  height: 100%;
  background: var(--brand);
  color: #fff;
  padding: 40px 28px;
  transition: left .3s;
  z-index: 1300;
  display: flex;
  flex-direction: column;
  gap: 28px;
}

.side-menu.active { left: 0; }

.side-menu .close-btn {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 36px;
  position: absolute;
  top: 16px;
  right: 22px;
  cursor: pointer;
}

.side-menu ul {
  list-style: none;
  padding: 0;
  margin: 40px 0 0 0;
  display: flex;
  flex-direction: column;
  gap: 22px;
}

.side-menu li a {
  color: #fff;
  text-decoration: none;
  font-size: 1.4rem;
  font-weight: 600;
  padding: 6px 0;
  display: block;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.side-menu li a:hover {
  color: var(--accent);
}


/* hero */
#hero{position:relative;height:70vh;min-height:360px;overflow:hidden;border-bottom:1px solid rgba(15,23,36,0.06)}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .6s}
.slide.active{opacity:1}
.slide::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.35),rgba(2,6,23,0.12))}
.slide-content{position:relative;z-index:2;max-width:var(--maxw);margin:0 auto;padding:28px;color:var(--accent);display:flex;gap:24px;align-items:center;justify-content:center}
.slide-text h1{margin:0;font-size:34px;color:#fff}
.btn{background:var(--accent);color:var(--brand);border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(251,133,0,0.12)}
.dots{position:absolute;bottom:18px;width:100%;text-align:center;z-index:3}
.dot{display:inline-block;width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.6);margin:0 6px;cursor:pointer;opacity:.7}
.dot.active{background:var(--accent-2);opacity:1}
.arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.35);border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:20px}
.arrow-left{left:18px}.arrow-right{right:18px}

@media (max-width: 768px) {
  .slide-content {
    flex-direction: column;
    text-align: center;
    gap: 14px;
  }
  .slide-content img {
    width: 140px;
    height: 140px;
  }
  .slide-text h1 {
    font-size: 24px;
  }
  .hero-cta .btn {
    font-size: 16px;
    padding: 8px 14px;
  }
}

  
/* layout & cards */
.container{max-width:var(--maxw);margin:0 auto;padding:28px}
.section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px}
.card{background:var(--surface);padding:14px;border-radius:12px;box-shadow:var(--shadow);position:relative;overflow:visible;border:1px solid rgba(2,6,23,0.04)}
.img-wrapper{position:relative;border-radius:10px;overflow:hidden}
.card img{display:block;width:100%;height:220px;object-fit:cover;cursor:pointer}
.promo-label{position:absolute;top:12px;left:12px;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#fff;padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px;z-index:5}
.countdown-overlay{position:absolute;left:0;right:0;bottom:0;background:rgba(255,183,3,0.95);color:#071123;padding:6px 8px;border-bottom-left-radius:10px;border-bottom-right-radius:10px;font-weight:700;font-size:13px;text-align:center;z-index:6}
.price-row{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0}
.price-old{text-decoration:line-through;color:var(--muted);font-size:13px}
.price-new{color:var(--danger);font-weight:800}
.stars{color:#f6c453;margin-bottom:8px}

/* gallery -> slider */
.gallery-slider{position:relative;overflow:hidden}
.gallery-track{display:flex;transition:transform .45s ease}
.gallery-slide{min-width:260px;margin:8px;border-radius:12px;overflow:hidden;box-shadow:var(--shadow);flex-shrink:0}
.gallery-slide img{width:100%;height:220px;object-fit:cover;display:block}

/* lightbox */
.lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,0.85);z-index:1400}
.lightbox img{max-width:92%;max-height:86%;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.6)}
.lightbox .close-light{position:absolute;top:18px;right:28px;color:#fff;font-size:28px;cursor:pointer}
.lightbox .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:none;border:none;color:#fff;font-size:40px;padding:8px;cursor:pointer}
.lightbox .prev{left:12px}.lightbox .next{right:12px}

/* testimonial slider */
.testimonial-wrap{position:relative;padding:14px;background:linear-gradient(180deg,#fff,#fbfbfb);border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
.testimonial-track{display:flex;transition:transform .45s ease}
.testimonial-card{min-width:300px;padding:16px;text-align:center;flex-shrink:0}
.testimonial-card img{width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:12px}

.quick-order {
  display: grid;
  gap: 12px;
  background: var(--surface);
  padding: 20px;
  border-radius: 14px;
  box-shadow: var(--shadow);
}
.quick-order input,
.quick-order select,
.quick-order textarea {
  padding: 10px;
  border: 1px solid rgba(2,6,23,0.1);
  border-radius: 8px;
  width: 100%;
  font-size: 15px;
}
.quick-order button {
  width: fit-content;
}

.feed-grid {
  display: grid;
  grid-template-columns: 30% 70%;
  gap: 20px;
}
@media (max-width: 768px) {
  .feed-grid {
    grid-template-columns: 1fr;
  }
}
  
/* cart & floats */
.whatsapp-float{position:fixed;bottom:18px;right:18px;z-index:1300}
.whatsapp-float a img{width:56px;height:56px;border-radius:12px;box-shadow:0 8px 22px rgba(11,18,32,0.15)}
.floating-cart{position:fixed;bottom:86px;right:26px;z-index:1301;background:var(--accent);width:56px;height:56px;border-radius:14px;display:none;align-items:center;justify-content:center;font-weight:800;color:var(--brand);cursor:pointer;box-shadow:0 10px 30px rgba(15,23,36,0.12)}
.cart-badge{position:absolute;top:-8px;right:-8px;background:var(--danger);color:#fff;padding:4px 7px;border-radius:999px;font-size:12px}
.cart-panel{position:fixed;top:0;right:-420px;width:380px;height:100%;background:var(--bg);box-shadow:-20px 0 40px rgba(2,6,23,0.12);transition:right .35s;padding:20px;z-index:1350;overflow:auto}
.cart-panel.active{right:0}
.close-cart{position:absolute;top:12px;right:16px;font-size:22px;cursor:pointer}
#scrollTopBtn {
  position: fixed;
  bottom: 18px;
  right: 90px;
  background: var(--accent);
  color: var(--brand);
  border: none;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display: none;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  box-shadow: var(--shadow);
  cursor: pointer;
  z-index: 1400;
}

  #toastPlace {
  position: fixed;
  bottom: 120px;
  left: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 1600;
}
.toast {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--brand);
  color: #fff;
  padding: 10px 14px;
  border-radius: 10px;
  box-shadow: var(--shadow);
  max-width: 260px;
  animation: fadeIn .3s ease;
}
@keyframes fadeIn {
  from {opacity:0;transform:translateY(10px);}
  to {opacity:1;transform:translateY(0);}
}

  
/* responsive */
@media(max-width:900px){
  .slide-content{flex-direction:column;text-align:center}
  .slide-content img{width:160px;height:160px}
  .menu-toggle{display:inline-block}
  nav ul{display:none}
  .gallery-slide{min-width:220px}
  .testimonial-card{min-width:260px}
}

.floating-buttons {
  position: fixed;
  bottom: 18px;
  right: 18px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  z-index: 1400;
}

.floating-buttons button,
.floating-buttons a img {
  width: 56px;
  height: 56px;
  border-radius: 14px;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  justify-content: center;
}

</style>
</head>
<body>
<!-- promo -->
<div class="promo-marquee" id="promoBar"><marquee id="promoText" behavior="scroll" direction="left">🔥 FLASH SALE Hari ini — Tersisa 3 item lagi! 🔥</marquee></div>

<!-- header -->
<header>
  <button class="menu-toggle" onclick="toggleMenu()" aria-label="Buka menu">☰</button>
  <div class="logo"><img id="siteLogo" src="assets/logo.png" alt="Navid Snack logo"/><span id="siteBrand">Navid Snack</span></div>
  <nav>
    <ul>
      <li><a href="#hero">Beranda</a></li>
      <li><a href="#products">Produk</a></li>
      <li><a href="#gallery">Galeri</a></li>
      <li><a href="#testimonials">Testimoni</a></li>
      <li><a href="#feed">Feed</a></li>
      <li><a href="#contact">Kontak</a></li>
    </ul>
  </nav>
  <button class="btn-toggle" onclick="toggleDarkMode()" aria-pressed="false" title="Toggle dark mode">🌙</button>
</header>

<!-- side menu -->
<div id="sideMenu" class="side-menu" aria-hidden="true">
  <button class="close-btn" onclick="toggleMenu()" aria-label="Tutup">×</button>
  <ul>
    <li><a href="#hero" onclick="toggleMenu()">Beranda</a></li>
    <li><a href="#products" onclick="toggleMenu()">Produk</a></li>
    <li><a href="#gallery" onclick="toggleMenu()">Galeri</a></li>
    <li><a href="#testimonials" onclick="toggleMenu()">Testimoni</a></li>
    <li><a href="#feed" onclick="toggleMenu()">Feed</a></li>
    <li><a href="#contact" onclick="toggleMenu()">Kontak</a></li>
  </ul>
</div>

<!-- HERO -->
<section id="hero">
  <button class="arrow arrow-left" onclick="prevSlide()" aria-label="Sebelumnya">❮</button>
  <button class="arrow arrow-right" onclick="nextSlide()" aria-label="Berikutnya">❯</button>

  <!-- slides will be rendered here -->
  <div id="slidesContainer"></div>

  <div class="dots" id="heroDots"></div>
</section>

<!-- PRODUCTS -->
<section id="products" class="container" aria-labelledby="productsTitle">
  <div class="section-title"><h2 id="productsTitle">Produk Unggulan</h2></div>
  <div class="products-grid" id="productsGrid"></div>
</section>

<!-- GALLERY -->
<section id="gallery" class="container" aria-labelledby="galleryTitle">
  <div class="section-title"><h2 id="galleryTitle">Galeri Produk</h2></div>
  <div class="gallery-slider" id="gallerySlider">
    <div class="gallery-track" id="galleryTrack"></div>
  </div>
</section>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
  <button class="nav-btn prev" onclick="prevGallery()" aria-label="Sebelumnya">❮</button>
  <img id="lightboxImg" alt="Preview"/>
  <button class="nav-btn next" onclick="nextGallery()" aria-label="Berikutnya">❯</button>
  <button class="close-light" onclick="closeLightbox()" aria-label="Tutup">×</button>
</div>

<!-- TESTIMONIAL -->
<section id="testimonials" class="container" aria-labelledby="testiTitle">
  <div class="section-title"><h2 id="testiTitle">Testimoni Pelanggan</h2></div>
  <div class="testimonial-wrap">
    <div style="overflow:hidden">
      <div id="testiTrack" class="testimonial-track"></div>
    </div>
    <div class="testimonial-nav" style="margin-top:12px">
      <button class="btn" onclick="testiPrev()">❮</button>
      <button class="btn" onclick="testiNext()">❯</button>
    </div>
  </div>
</section>

<!-- QUICK ORDER FORM -->
<section class="container" aria-labelledby="quickOrderTitle" style="margin-top:18px">
  <div class="section-title"><h2 id="quickOrderTitle">Form Pemesanan Cepat</h2></div>
  <form id="quickOrderForm" class="quick-order" onsubmit="submitQuickOrder(event)">
    <input id="qName" type="text" placeholder="Nama lengkap" required aria-label="Nama"/>
    <input id="qWA" type="tel" placeholder="Nomor WhatsApp (contoh: 0812...)" required aria-label="Nomor WA"/>
    <input id="qAddr" type="text" placeholder="Alamat (kelurahan/kota)" required aria-label="Alamat"/>
    <select id="qProduct" required aria-label="Pilih produk"></select>
    <input id="qQty" type="number" min="1" value="1" required aria-label="Jumlah"/>
    <textarea id="qNote" rows="2" placeholder="Catatan / request (opsional)"></textarea>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="btn" type="submit">Kirim ke WhatsApp Admin</button>
      <small style="color:var(--muted)">Subtotal akan disertakan sebelum ongkir</small>
    </div>
  </form>
</section>

<!-- floating elements -->
<div class="floating-buttons">
  <button class="floating-cart" id="floatingCart" onclick="toggleCart()" aria-label="Buka keranjang">🛒<span class="cart-badge" id="cartBadge">0</span></button>
  <div class="whatsapp-float" title="Chat via WhatsApp"><a id="waLink" href="#" target="_blank" rel="noreferrer"><img src="https://img.icons8.com/color/96/whatsapp.png" alt="WhatsApp Navid Snack"/></a></div>
  <button class="scroll-top" id="scrollTopBtn" onclick="scrollToTop()" aria-label="Kembali ke atas">↑</button>
</div>

<!-- cart panel -->
<aside id="cartPanel" class="cart-panel" aria-label="Keranjang belanja">
  <button class="close-cart" onclick="toggleCart()">×</button>
  <h3>Keranjang</h3>
  <div id="cartItems" style="margin-top:14px"></div>
  <p style="margin-top:12px"><strong>Subtotal:</strong> Rp <span id="cartTotal">0</span></p>
  <p style="font-size:13px;color:var(--muted)">Belum termasuk ongkir</p>
  <div style="display:flex;gap:8px;margin-top:12px">
    <button class="btn" onclick="checkout()">Checkout via WhatsApp</button>
    <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="clearCart()">Bersihkan</button>
  </div>
</aside>

<!-- product modal -->
<div id="productModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1500">
  <div style="background:var(--bg);padding:18px;border-radius:10px;max-width:520px;width:calc(100% - 40px);position:relative">
    <button onclick="closeProductModal()" style="position:absolute;top:10px;right:12px;background:none;border:none;font-size:22px;cursor:pointer">×</button>
    <img id="modalImg" src="" alt="Detail produk" style="width:100%;height:300px;object-fit:cover;border-radius:8px;margin-bottom:10px">
    <h3 id="modalName"></h3>
    <p id="modalDesc" style="color:var(--muted)"></p>
    <p id="modalPrice" style="font-weight:800;color:var(--danger)"></p>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" onclick="addToCartFromModal()">Tambah ke Keranjang</button>
      <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="closeProductModal()">Tutup</button>
    </div>
  </div>
</div>

<!-- feed (instagram + youtube) -->
<section id="feed" class="container" aria-labelledby="feedTitle">
  <div class="section-title"><h2 id="feedTitle">Media Sosial</h2></div>
  <div class="feed-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
    <div class="feed-ig" style="background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--shadow)">
      <h3 style="margin-bottom:10px;color:var(--brand)">Instagram</h3>
      <div id="igEmbedContainer"></div>
    </div>
    <div class="feed-yt" style="background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--shadow)">
      <h3 style="margin-bottom:10px;color:var(--brand)">YouTube</h3>
      <div class="yt-wrapper">
        <iframe id="ytFrame" src="" title="Navid Snack YouTube" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" style="width:100%;height:315px;border-radius:12px"></iframe>
      </div>
    </div>
  </div>
</section>

<!-- footer -->
<footer id="contact">
  <div class="footer-grid" style="display:flex;gap:20px;flex-wrap:wrap;max-width:var(--maxw);margin:0 auto;padding:28px;background:#08101a;color:#fff">
    <div class="footer-info" style="flex:1 1 320px">
      <h3 id="footerBrand">Navid Snack</h3>
      <p id="footerAddr">Alamat: Deket, Lamongan, Jawa Timur</p>
      <p id="footerPhone">Telp: +62 812-3456-7890</p>
      <p style="margin-top:8px"><strong>Certificate:</strong></p>
      <div id="certRow" style="display:flex;gap:8px;align-items:center;margin-top:8px"></div>
    </div>
    <div class="footer-map" style="flex:1 1 320px">
      <h4>Lokasi</h4>
      <iframe id="mapFrame" src="https://www.google.com/maps/embed?pb=!1m18!..." style="width:100%;height:220px;border:0;border-radius:10px" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="Lokasi Navid Snack"></iframe>
    </div>
  </div>
</footer>

<!-- toast placeholder -->
<div id="toastPlace"></div>

<!-- Instagram embed script (official) -->
<script async defer src="//www.instagram.com/embed.js"></script>

<!-- load data.js first (you uploaded it as data.js) -->
<script src="js/data.js"></script>

<script>
/* =============
   MAIN SCRIPT
   - uses window.SITE, window.SLIDES, window.PRODUCTS, window.GALLERY, window.TESTIMONIALS, window.NOTIFIKASI
   ============= */

/* -------------------------
   Helper selectors (unchanged)
   -------------------------*/
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));

/* -------------------------
   Update head/meta from SITE
   -------------------------*/
function applySiteMeta(){
  if(!window.SITE) return;
  const site = window.SITE;
  const brand = site.brand || document.title;
  $('#pageTitle').textContent = brand + (brand.includes('Navid')? '' : ' — Navid Snack');
  $('#metaDescription').setAttribute('content', (site.description || $('#metaDescription').getAttribute('content')));
  $('#metaKeywords').setAttribute('content', (site.keywords || $('#metaKeywords').getAttribute('content')));
  $('#siteBrand').textContent = site.brand || 'Navid Snack';
  $('#footerBrand').textContent = site.brand || 'Navid Snack';
  $('#siteLogo').src = site.img || $('#siteLogo').src;
  $('#favicon').href = site.img || $('#favicon').href;
  $('#waLink').href = site.wa ? `https://wa.me/${site.wa}` : $('#waLink').href;
  $('#footerAddr').textContent = 'Alamat: ' + (site.alamat || '');
  // certificates
  const certRow = $('#certRow');
  certRow.innerHTML = '';
  (site.sertifikat || []).forEach(c=>{
    const img = document.createElement('img');
    img.src = c.src; img.alt = c.alt; img.style.height='40px'; img.style.borderRadius='6px';
    img.loading = 'lazy';
    certRow.appendChild(img);
  });

  // OG meta
  $('#ogTitle').setAttribute('content', site.brand || document.title);
  $('#ogDesc').setAttribute('content', site.description || $('#metaDescription').getAttribute('content'));
  $('#ogImage').setAttribute('content', site.img || $('#ogImage').getAttribute('content'));
}

/* ======================
   HERO SLIDER (dynamic)
   ====================== */
let slides = [], dots = [], slideCur = 0, slideTimer = null;
function renderHero(){
  const container = $('#slidesContainer');
  const dotsWrap = $('#heroDots');
  container.innerHTML = '';
  dotsWrap.innerHTML = '';
  const data = window.SLIDES || [];
  data.forEach((s,i)=>{
    const slide = document.createElement('div');
    slide.className = 'slide' + (i===0?' active':'');
    slide.style.backgroundImage = `url('${s.bg}')`;
    slide.setAttribute('role','img');
    slide.setAttribute('aria-label', s.title||('Slide '+(i+1)));
    slide.innerHTML = `
      <div class="slide-content">
        <img src="${s.img}" alt="${s.title}" loading="lazy"/>
        <div class="slide-text">
          <h1>${s.title}</h1>
          <p>${s.text || ''}</p>
          ${ s.cta ? `<div class="hero-cta"><a href="${s.cta.link}" class="btn" aria-label="${s.cta.text}">${s.cta.text}</a></div>` : '' }
        </div>
      </div>
    `;
    container.appendChild(slide);

    const dot = document.createElement('span');
    dot.className = 'dot' + (i===0?' active':'');
    dot.addEventListener('click', ()=> showSlide(i));
    dotsWrap.appendChild(dot);
  });
  slides = $$('.slide');
  dots = $$('.dot');
  slideCur = 0;
  if(slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(nextSlide, 6000);
}
function showSlide(n){
  slideCur = (n+slides.length)%slides.length;
  slides.forEach((s,i)=>s.classList.toggle('active', i===slideCur));
  dots.forEach((d,i)=>d.classList.toggle('active', i===slideCur));
}
function nextSlide(){ showSlide(slideCur+1) }
function prevSlide(){ showSlide(slideCur-1) }

/* ====== SIDE MENU (HAMBURGER) - unchanged name ====== */
function toggleMenu(){
  const menu = $('#sideMenu');
  const isActive = menu.classList.toggle('active');
  menu.setAttribute('aria-hidden', !isActive);
}
document.addEventListener('click', (e)=>{
  const side = $('#sideMenu');
  const btn = e.target.closest('.menu-toggle')!==null;
  if(!btn && side.classList.contains('active') && !e.target.closest('.side-menu')) {
    side.classList.remove('active');
    side.setAttribute('aria-hidden','true');
  }
});

/* ====== DARK MODE (with localStorage) ====== */
function applyDarkModeFromStorage(){
  const val = localStorage.getItem('navid_darkmode');
  if(val === '1') document.body.classList.add('dark-mode');
  else document.body.classList.remove('dark-mode');
  const t = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
  $$('.btn-toggle').forEach(b=>b.textContent = t);
}
function toggleDarkMode(){
  document.body.classList.toggle('dark-mode');
  const active = document.body.classList.contains('dark-mode');
  localStorage.setItem('navid_darkmode', active ? '1' : '0');
  const t = active ? '☀️' : '🌙';
  $$('.btn-toggle').forEach(b=>b.textContent = t);
}

/* ============================
   PRODUCTS (render from PRODUCTS)
   ============================ */
function formatRupiah(v){ if(!v) return ''; return 'Rp ' + Number(v).toLocaleString('id-ID'); }

/* ============================
   PRODUCTS (dengan countdown promo)
   ============================ */
function isPromoActive(prod){
  const now = new Date();
  const tzOffset = now.getTimezoneOffset() * 60000; // supaya jam lokal
  const todayStr = now.toISOString().slice(0,10);

  const tglStart = prod.tglPromoStart || '';
  const tglEnd = prod.tglPromoEnd || tglStart || '';
  const jamStart = prod.jamPromoStart || '';
  const jamEnd = prod.jamPromoEnd || '';

  // buat Date dari kombinasi tgl+jam
  function combine(tgl, jam){
    if(!tgl) return null;
    const hh = jam? jam.split(':')[0] : '00';
    const mm = jam? jam.split(':')[1] : '00';
    return new Date(`${tgl}T${hh}:${mm}:00`);
  }

  // kasus 1: tanggal saja (full-day)
  if(tglStart && !jamStart){
    const start = combine(tglStart,'00:00');
    const end = combine(tglEnd||tglStart,'23:59');
    return now >= start && now <= end;
  }

  // kasus 2: jam saja (berulang setiap hari)
  if(!tglStart && jamStart){
    const today = todayStr;
    const start = combine(today,jamStart);
    const end = combine(today,jamEnd||jamStart);
    if(jamEnd && jamEnd < jamStart){ // lintas tengah malam
      const endTomorrow = combine(new Date(now.getTime()+86400000).toISOString().slice(0,10),jamEnd);
      return now >= start || now <= endTomorrow;
    }
    return now >= start && now <= end;
  }

  // kasus 3: tanggal + jam
  if(tglStart && jamStart){
    const start = combine(tglStart,jamStart);
    const end = combine(tglEnd||tglStart,jamEnd||jamStart);
    if(jamEnd && jamEnd < jamStart && tglStart===tglEnd){
      const endNext = new Date(end.getTime()+86400000);
      return now >= start && now <= endNext;
    }
    return now >= start && now <= end;
  }
  return false;
}

function getPromoRemaining(prod){
  // kembalikan sisa waktu dalam ms
  const now = new Date();
  const tglStart = prod.tglPromoStart || '';
  const tglEnd = prod.tglPromoEnd || tglStart || '';
  const jamStart = prod.jamPromoStart || '';
  const jamEnd = prod.jamPromoEnd || '';

  function combine(tgl, jam){
    const hh = jam? jam.split(':')[0] : '00';
    const mm = jam? jam.split(':')[1] : '00';
    return new Date(`${tgl}T${hh}:${mm}:00`);
  }

  if(tglStart && !jamStart){
    return combine(tglEnd,'23:59') - now;
  }
  if(!tglStart && jamStart){
    const today = new Date().toISOString().slice(0,10);
    let end = combine(today,jamEnd||jamStart);
    if(jamEnd && jamEnd < jamStart){
      const tomorrow = new Date(now.getTime()+86400000).toISOString().slice(0,10);
      end = combine(tomorrow,jamEnd);
    }
    return end - now;
  }
  if(tglStart && jamStart){
    let end = combine(tglEnd||tglStart,jamEnd||jamStart);
    if(jamEnd && jamEnd < jamStart && tglStart===tglEnd){
      end = new Date(end.getTime()+86400000);
    }
    return end - now;
  }
  return 0;
}

function formatCountdown(ms){
  if(ms<=0) return '00:00:00';
  let sec = Math.floor(ms/1000);
  const h = String(Math.floor(sec/3600)).padStart(2,'0');
  sec %= 3600;
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

function renderProducts(){
  const grid = $('#productsGrid');
  grid.innerHTML = '';
  const prods = window.PRODUCTS || [];

  prods.forEach(p=>{
    const active = isPromoActive(p);
    const art = document.createElement('article');
    art.className = 'card';
    art.dataset.name = p.name;
    art.dataset.price = p.price;
    art.dataset.oldprice = p.oldPrice || '';
    art.dataset.stock = p.stock || 0;
    art.dataset.promo = active ? 'true' : 'false';
    art.dataset.desc = p.desc || '';
    art.dataset.img = p.img || '';

    art.innerHTML = `
      <div class="img-wrapper">
        <img src="${p.img}" alt="${p.name}" loading="lazy" onclick="openProductModal(this)">
        ${active ? '<div class="promo-label">PROMO</div>' : ''}
        ${active ? `<div class="countdown-overlay" data-cid></div>` : ''}
      </div>
      <h3>${p.name}</h3>
      <div class="price-row">
        <span class="price-old">${p.oldPrice? formatRupiah(p.oldPrice) : ''}</span>
        <span class="price-new">${formatRupiah(p.price)}</span>
      </div>
      <div class="stars">${'★★★★★'.slice(0,p.rating||5)}</div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
        <button class="btn" onclick="addToCart(this)">Tambah ke Keranjang</button>
        <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="quickOrderPref('${escapeQuotes(p.name)}',${p.price})">Pesan Cepat</button>
      </div>
    `;
    grid.appendChild(art);

    // Countdown promo jika aktif
    if(active){
      const countdownEl = art.querySelector('[data-cid]');
      const tick = ()=>{
        const ms = getPromoRemaining(p);
        countdownEl.textContent = `Berakhir dalam ${formatCountdown(ms)}`;
        if(ms<=0) {
          // Hapus label promo & countdown jika waktu habis
          const lbl = countdownEl.parentElement.querySelector('.promo-label');
          if(lbl) lbl.remove();
          countdownEl.remove();
        }
      };
      tick();
      setInterval(tick, 1000);
    }
  });

  // ================
  // isi dropdown form (produk + paket khusus)
  // ================
  const qSel = $('#qProduct');
  qSel.innerHTML = '<option value="">Pilih produk atau paket...</option>';

  // produk
  prods.forEach(p=> 
    qSel.insertAdjacentHTML('beforeend', `<option value="${p.name}|${p.price}">${p.name} - ${formatRupiah(p.price)}</option>`)
  );

  // paket khusus dari data.js
  (window.PACKAGES || []).forEach(pkg=>{
    qSel.insertAdjacentHTML('beforeend', `<option value="${pkg.name}|${pkg.price}">🌟 ${pkg.name} - ${formatRupiah(pkg.price)}</option>`);
  });
}



// helper to escape single quotes in onclick inline string
function escapeQuotes(s){ return (s||'').replace(/'/g,"\\'").replace(/"/g,'&quot;'); }

/* ============================
   CART (persist in localStorage)
   ============================ */
let cart = []; // {name, price, qty, stock}
const floatingCartBtn = $('#floatingCart');
const cartBadge = $('#cartBadge');
const cartItemsWrap = $('#cartItems');
const cartTotalEl = $('#cartTotal');

function loadCartFromStorage(){
  try{
    const raw = localStorage.getItem('navid_cart');
    if(raw) cart = JSON.parse(raw);
    else cart = [];
  }catch(e){ cart = []; }
  renderCart();
  if(cart.length===0) floatingCartBtn.style.display='none';
  else floatingCartBtn.style.display='flex';
}
function saveCartToStorage(){ localStorage.setItem('navid_cart', JSON.stringify(cart)); }

function addToCart(btn){
  const card = btn.closest('.card');
  addProductToCartFromCard(card);
}
function addProductToCartFromCard(card){
  const name = card.dataset.name;
  const price = Number(card.dataset.price || 0);
  const stock = Number(card.dataset.stock || 999);
  let found = cart.find(x=>x.name===name);
  if(found){
    if(found.qty+1 > stock){ showToast('Stok tidak cukup untuk ' + name); return; }
    found.qty++;
  } else {
    cart.push({name, price, qty:1, stock});
  }
  saveCartToStorage();
  renderCart();
  showToast(name + ' ditambahkan ke keranjang');
  floatingCartBtn.style.display = 'flex';
}
function addToCartFromModal(){
  const name = $('#modalName').textContent;
  const priceText = $('#modalPrice').getAttribute('data-price') || $('#modalPrice').textContent.replace(/[^0-9]/g,'') || 0;
  const price = Number(priceText);
  let found = cart.find(x=>x.name===name);
  if(found) found.qty++;
  else cart.push({name, price, qty:1, stock:99});
  saveCartToStorage();
  renderCart();
  showToast(name + ' ditambahkan ke keranjang');
  floatingCartBtn.style.display = 'flex';
  closeProductModal();
}

function renderCart(){
  if(!cartItemsWrap) return;
  cartItemsWrap.innerHTML = '';
  let total = 0;
  cart.forEach((it, i) => {
    total += it.price * it.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.style.padding = '10px 0';
    div.innerHTML = `
      <strong>${it.name}</strong><div style="margin-top:6px">Rp ${it.price.toLocaleString('id-ID')} &nbsp;
      <button onclick="decQty(${i})">-</button>
      <input type="number" value="${it.qty}" min="1" style="width:56px" onchange="setQty(${i}, this.value)">
      <button onclick="incQty(${i})">+</button>
      &nbsp; = <strong>Rp ${(it.price*it.qty).toLocaleString('id-ID')}</strong>
      <button style="float:right;background:transparent;border:none;color:var(--danger);cursor:pointer" onclick="removeItem(${i})">🗑️</button>
      </div>
    `;
    cartItemsWrap.appendChild(div);
  });
  cartTotalEl.textContent = total.toLocaleString('id-ID');
  cartBadge.textContent = cart.reduce((s,i)=>s+i.qty,0);
}

function incQty(i){ if(cart[i].qty < cart[i].stock) cart[i].qty++; saveCartToStorage(); renderCart(); }
function decQty(i){ if(cart[i].qty > 1) cart[i].qty--; saveCartToStorage(); renderCart(); }
function setQty(i, val){ let q = Number(val); if(isNaN(q) || q<1) q=1; if(q>cart[i].stock){ showToast('Melebihi stok tersedia'); q = cart[i].stock; } cart[i].qty = q; saveCartToStorage(); renderCart(); }
function removeItem(i){ cart.splice(i,1); saveCartToStorage(); renderCart(); if(cart.length===0){ floatingCartBtn.style.display='none'; } }
function clearCart(){ cart=[]; saveCartToStorage(); renderCart(); toggleCart(); showToast('Keranjang dibersihkan'); floatingCartBtn.style.display='none'; }

function toggleCart(){ $('#cartPanel').classList.toggle('active'); }

/* ====== CHECKOUT via WA (uses SITE.wa) ====== */
function checkout(){
  if(cart.length===0){ showToast('Keranjang masih kosong'); return; }
  let msg = 'Halo, saya ingin pesan:%0A';
  let subtotal = 0;
  cart.forEach(it=>{
    msg += `${it.name} x ${it.qty} = Rp ${ (it.price*it.qty).toLocaleString('id-ID') }%0A`;
    subtotal += it.price * it.qty;
  });
  msg += `%0ASubtotal: Rp ${subtotal.toLocaleString('id-ID')} (belum termasuk ongkir)`;
  const wa = (window.SITE && window.SITE.wa) ? window.SITE.wa : '6281234567890';
  window.open('https://wa.me/' + wa + '?text=' + encodeURIComponent(msg));
}

/* ====== QUICK ORDER FORM ====== */
function quickOrderPref(name, price){
  $('#qProduct').value = `${name}|${price}`;
  $('#qQty').value = 1;
  $('#qName').focus();
  window.scrollTo({top:document.getElementById('quickOrderForm').offsetTop-80,behavior:'smooth'});
}
function submitQuickOrder(e){
  e.preventDefault();
  const name = $('#qName').value.trim(), wa = $('#qWA').value.trim(), addr = $('#qAddr').value.trim();
  const prod = $('#qProduct').value, qty = Number($('#qQty').value), note = $('#qNote').value;
  if(!prod){ showToast('Pilih produk'); return; }
  const [pname,pprice] = prod.split('|'); const subtotal = Number(pprice)*qty;
  let text = `Halo, saya *${name}* ingin memesan:%0A- ${pname} x ${qty} = Rp ${subtotal}%0AAlamat: ${addr}%0ANo WA: ${wa}%0ANote: ${note||'-'}%0A(Subtotal belum termasuk ongkir)`;
  const waNum = (window.SITE && window.SITE.wa) ? window.SITE.wa : '6281234567890';
  window.open('https://wa.me/' + waNum + '?text=' + encodeURIComponent(text));
}

/* ====== TOAST notification ====== */
function showToast(text, delay = 4000){
  const t = document.createElement('div'); t.className='toast';
  t.style.opacity = '1';
  t.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" style="opacity:.9;margin-right:8px"><circle cx="12" cy="12" r="10" fill="#ffcf6b"/></svg><div>${text}</div>`;
  $('#toastPlace').appendChild(t);
  setTimeout(()=>{ t.style.transition='opacity .5s'; t.style.opacity=0; t.addEventListener('transitionend', ()=>t.remove()); }, delay);
}
const salesSamples = (window.NOTIFIKASI || []).map(n=>[n.nama,n.kota,n.produk]);
if(salesSamples.length>0) setInterval(()=>{ const s = salesSamples[Math.floor(Math.random()*salesSamples.length)]; showToast(`${s[0]} dari ${s[1]} baru saja membeli ${s[2]}`); }, 14000);

/* =========================
   GALLERY slider & lightbox
   ========================= */
/* =========================
   GALLERY slider + tombol + swipe di lightbox
   ========================= */
let galleryIndex = 0;
function renderGallery(){
  const data = window.GALLERY || [];
  const track = $('#galleryTrack');
  track.innerHTML = '';
  const slides = data.concat(data).concat(data);
  slides.forEach((g,i)=>{
    const el = document.createElement('div');
    el.className = 'gallery-slide';
    el.innerHTML = `<img src="${g.src}" alt="${g.alt||''}" loading="lazy" data-idx="${i%data.length}" onclick="openLightbox(${i%data.length})">`;
    track.appendChild(el);
  });
  galleryIndex = data.length;
  updateGalleryTransform();
}

function updateGalleryTransform(){
  const track = $('#galleryTrack');
  const w = track.querySelector('.gallery-slide')?.offsetWidth || 260;
  track.style.transform = `translateX(-${galleryIndex * (w+16)}px)`;
}
function prevGallery(){ galleryIndex=(galleryIndex-1+$('#galleryTrack').children.length)%$('#galleryTrack').children.length; updateGalleryTransform(); }
function nextGallery(){ galleryIndex=(galleryIndex+1)%$('#galleryTrack').children.length; updateGalleryTransform(); }

let lightboxIdx = 0;
function openLightbox(i){
  lightboxIdx = i;
  showLightboxImage();
  $('#lightbox').style.display='flex';
}
function showLightboxImage(){
  $('#lightboxImg').src = window.GALLERY[lightboxIdx].src;
}
function prevLightbox(){ lightboxIdx = (lightboxIdx-1+window.GALLERY.length)%window.GALLERY.length; showLightboxImage(); }
function nextLightbox(){ lightboxIdx = (lightboxIdx+1)%window.GALLERY.length; showLightboxImage(); }
$('#lightbox .prev').onclick = prevLightbox;
$('#lightbox .next').onclick = nextLightbox;
function closeLightbox(){ $('#lightbox').style.display='none'; }

function enableGallerySwipe(){
  const track = $('#galleryTrack');
  let startX=0,dx=0,isDown=false;
  track.addEventListener('touchstart',e=>{isDown=true;startX=e.touches[0].clientX});
  track.addEventListener('touchmove',e=>{if(!isDown)return;dx=e.touches[0].clientX-startX});
  track.addEventListener('touchend',()=>{if(!isDown)return;isDown=false;if(Math.abs(dx)>40){dx>0?prevGallery():nextGallery();}dx=0});
}
/* swipe dalam lightbox */
(function(){
  const img=$('#lightboxImg');
  let startX=0,dx=0,isDown=false;
  img.addEventListener('touchstart',e=>{isDown=true;startX=e.touches[0].clientX});
  img.addEventListener('touchmove',e=>{if(!isDown)return;dx=e.touches[0].clientX-startX});
  img.addEventListener('touchend',()=>{if(!isDown)return;isDown=false;if(Math.abs(dx)>40){dx>0?prevLightbox():nextLightbox();}dx=0});
})();


/* =========================
   TESTIMONIAL slider (looping + swipe)
   ========================= */
/* =========================
   TESTIMONIAL slider (tombol + swipe)
   ========================= */
let testiIdx=0;
function renderTestimonials(){
  const t = window.TESTIMONIALS || [];
  const track = $('#testiTrack'); track.innerHTML='';
  const slides = t.concat(t).concat(t);
  slides.forEach(s=>{
    const el=document.createElement('div');
    el.className='testimonial-card';
    el.innerHTML=`<img src="${s.img}" alt="${s.name}" loading="lazy"/><p><strong>${s.name}, ${s.kota||''}</strong></p><p>"${s.text}"</p>`;
    track.appendChild(el);
  });
  testiIdx=t.length; updateTestiTransform();
}
function updateTestiTransform(){
  const track = $('#testiTrack');
  const w = track.querySelector('.testimonial-card')?.offsetWidth || 300;
  track.style.transform = `translateX(-${testiIdx*w}px)`;
}
function testiNext(){ testiIdx=(testiIdx+1)%$('#testiTrack').children.length; updateTestiTransform(); }
function testiPrev(){ testiIdx=(testiIdx-1+$('#testiTrack').children.length)%$('#testiTrack').children.length; updateTestiTransform(); }

function enableTestiSwipe(){
  const track = $('#testiTrack');
  let startX=0,dx=0,isDown=false;
  track.addEventListener('touchstart',e=>{isDown=true;startX=e.touches[0].clientX});
  track.addEventListener('touchmove',e=>{if(!isDown)return;dx=e.touches[0].clientX-startX});
  track.addEventListener('touchend',()=>{if(!isDown)return;isDown=false;if(Math.abs(dx)>40){dx>0?testiPrev():testiNext();}dx=0});
}


/* =========================
   PRODUCT MODAL (unchanged names)
   ========================= */
function openProductModal(imgEl){
  const card = imgEl.closest('.card');
  $('#modalImg').src = card.dataset.img || imgEl.src;
  $('#modalName').textContent = card.dataset.name || '';
  $('#modalDesc').textContent = card.dataset.desc || '';
  const price = card.dataset.price || '';
  $('#modalPrice').textContent = price ? formatRupiah(price) : '';
  $('#modalPrice').setAttribute('data-price', price || '');
  $('#productModal').style.display = 'flex';
}
function closeProductModal(){ $('#productModal').style.display = 'none'; }

/* ====== INSTAGRAM embed (kept as-is: uses array igUrls in original file or you can set in data.js) */
(function renderRandomIG(){
  const container = $('#igEmbedContainer');
  if(!container) return;
  const igUrls = window.IG_URLS || [
    // fallback placeholders; you can put actual embed URLs into window.IG_URLS in data.js
  ];
  const url = igUrls.length ? igUrls[Math.floor(Math.random()*igUrls.length)] : '';
  if(!url || !url.includes('/p/')){
    container.innerHTML = `<div style="padding:20px;background:var(--surface);border-radius:8px">Silakan ganti array <code>IG_URLS</code> di <code>data.js</code> dengan URL embed post dari akun Instagram Anda</div>`;
    return;
  }
  const block = document.createElement('blockquote'); block.className = 'instagram-media'; block.setAttribute('data-instgrm-permalink', url.replace('/embed','')); block.style = "width:100%;max-width:540px";
  block.innerHTML = `<a href="${url.replace('/embed','')}" target="_blank" rel="noopener noreferrer">Lihat di Instagram</a>`;
  container.appendChild(block);
  if(window.instgrm && window.instgrm.Embeds && typeof window.instgrm.Embeds.process === 'function'){
    try{ window.instgrm.Embeds.process(); }catch(e){ /* ignore */ }
  }
})();

/* ==============
   INIT / on DOM ready
   ============== */
window.addEventListener('DOMContentLoaded', ()=>{
  applySiteMeta();     // update title, logos, OG
  renderHero();        // hero from SLIDES
  renderProducts();    // render products grid from PRODUCTS
  renderGallery();     // render gallery slider from GALLERY
  renderTestimonials();// render testimonials slider
  enableGallerySwipe();
  enableTestiSwipe();
  applyDarkModeFromStorage();
  loadCartFromStorage();

  // Ensure floating cart hidden if empty
  if(cart.length===0) floatingCartBtn.style.display = 'none';

  // responsive transform update after images load
  setTimeout(()=>{ updateGalleryTransform(); updateTestiTransform(); }, 300);

  // expose some globals (keeps original names)
  window.slides = slides;
  window.nextSlide = nextSlide;
  window.prevSlide = prevSlide;
});

/* Accessibility: ESC to close modals/side menu */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    closeLightbox();
    closeProductModal();
    $('#sideMenu').classList.remove('active');
  }
});

/* SCROLL TOP */
function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}); }
window.addEventListener('scroll', ()=>{ $('#scrollTopBtn').style.display = (window.scrollY>200)?'inline-block':'none'; });

</script>
</body>
</html>
