<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="pageTitle">Navid Snack ‚Äî Camilan Sehat & Lezat Lamongan</title>
<meta name="description" id="metaDescription" content="Navid Snack - Camilan sehat & lezat dari Lamongan. Pesan cepat via WhatsApp. Halal, higienis, bergizi."/>
<meta name="keywords" id="metaKeywords" content="navid snack, camilan lamongan, keripik pisang, kacang gurih, snack sehat"/>

<!-- Open Graph (akan diupdate ke nilai dari data.js setelah data.js dimuat) -->
<meta property="og:title" content="" id="ogTitle"/>
<meta property="og:description" content="" id="ogDesc"/>
<meta property="og:image" content="" id="ogImage"/>
<meta property="og:type" content="website"/>

<link rel="icon" id="favicon" href="assets/logo.png" type="image/png"/>

<style>
:root{
  --bg:#fff;--surface:#fbfaf8;--muted:#7b7b7b;--text:#17202a;
  --brand:#0f1724;--accent:#ffb703;--accent-2:#fb8500;--soft:#f4f1ea;
  --success:#2d6a4f;--danger:#d00000;--glass:rgba(255,255,255,0.7);
  --radius:12px;--shadow:0 8px 24px rgba(17,24,39,0.08);--maxw:1200px;
}
body.dark-mode{
  --bg:#071021;--surface:#0f1724;--muted:#9aa6b2;--text:#e6eef4;
  --brand:#071127;--accent:#ffb703;--accent-2:#ff9f1c;--soft:#081226;
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  background:var(--bg);color:var(--text);line-height:1.5;
}

/* Promo marquee */
.promo-marquee{
  background:linear-gradient(90deg,#ff4800,#ffb703);
  color:#fff;font-weight:800;padding:8px 0;text-align:center;
}
.promo-marquee marquee{font-size:16px;letter-spacing:.5px}

/* Header */
header{position:sticky;top:0;z-index:1000;background:var(--brand);color:var(--accent);padding:12px 20px;display:flex;align-items:center;gap:16px;box-shadow:0 2px 8px rgba(2,6,23,0.15)}
.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:18px}
.logo img{width:36px;height:36px;border-radius:8px;background:var(--soft);padding:4px}
nav{margin-left:auto;display:flex;align-items:center;gap:16px}
nav ul{display:flex;gap:16px;list-style:none}
nav a{color:var(--accent);text-decoration:none;font-weight:600}
.menu-toggle{display:none;background:none;border:1px solid rgba(255,183,3,0.12);color:var(--accent);padding:8px;border-radius:8px;cursor:pointer}
.btn-toggle{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--accent);padding:8px 10px;border-radius:10px;cursor:pointer}

/* Hero slider */
#hero{position:relative;height:70vh;min-height:360px;overflow:hidden}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .6s}
.slide.active{opacity:1}
.slide::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.35),rgba(2,6,23,0.12))}
.slide-content{position:relative;z-index:2;max-width:var(--maxw);margin:0 auto;padding:28px;color:var(--accent);display:flex;gap:24px;align-items:center;justify-content:center;flex-wrap:wrap}
.slide-text h1{margin:0;font-size:34px;color:#fff;text-align:center}
.slide-text p{color:#eee;text-align:center}
.hero-cta{text-align:center;margin-top:12px}
.btn{background:var(--accent);color:var(--brand);border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(251,133,0,0.12)}
.arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.35);border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:20px;z-index:3}
.arrow-left{left:18px}.arrow-right{right:18px}

/* Layout umum */
.container{max-width:var(--maxw);margin:0 auto;padding:28px}
.section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;color:var(--brand)}

/* Produk */
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px}
.card{background:var(--surface);padding:14px;border-radius:12px;box-shadow:var(--shadow);position:relative;border:1px solid rgba(2,6,23,0.04);display:flex;flex-direction:column;justify-content:space-between}
.card img{width:100%;height:220px;object-fit:cover;border-radius:10px;cursor:pointer}
.promo-label{position:absolute;top:12px;left:12px;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#fff;padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px}
.countdown-overlay{position:absolute;left:0;right:0;bottom:0;background:rgba(255,183,3,0.95);color:#071123;padding:6px 8px;border-bottom-left-radius:10px;border-bottom-right-radius:10px;font-weight:700;font-size:13px;text-align:center}
.price-row{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0}
.price-old{text-decoration:line-through;color:var(--muted);font-size:13px}
.price-new{color:var(--danger);font-weight:800}
.stars{color:#f6c453;margin-bottom:8px;text-align:center}

/* Gallery slider */
.gallery-slider{position:relative;overflow:hidden}
.gallery-track{display:flex;transition:transform .45s ease}
.gallery-slide{min-width:260px;margin:8px;border-radius:12px;overflow:hidden;box-shadow:var(--shadow);flex-shrink:0}
.gallery-slide img{width:100%;height:220px;object-fit:cover;display:block}
.gallery-nav{position:absolute;top:40%;width:100%;display:flex;justify-content:space-between;pointer-events:none}
.gallery-nav button{pointer-events:auto;background:rgba(0,0,0,0.4);border:none;color:#fff;font-size:28px;padding:8px;border-radius:8px;cursor:pointer}

/* Lightbox */
.lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,0.85);z-index:1400}
.lightbox img{max-width:92%;max-height:86%;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.6)}
.lightbox .close-light{position:absolute;top:18px;right:28px;color:#fff;font-size:28px;cursor:pointer}
.lightbox .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:none;border:none;color:#fff;font-size:40px;padding:8px;cursor:pointer}
.lightbox .prev{left:12px}.lightbox .next{right:12px}

/* Testimonial slider */
.testimonial-wrap{position:relative;padding:14px;background:linear-gradient(180deg,#fff,#fbfbfb);border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
.testimonial-track{display:flex;transition:transform .45s ease}
.testimonial-card{min-width:300px;padding:16px;text-align:center;flex-shrink:0}
.testimonial-card img{width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:12px}
.testimonial-nav{text-align:center;margin-top:12px}
.testimonial-nav .btn{margin:0 8px}

/* Quick order */
.quick-order{display:grid;gap:12px;background:var(--surface);padding:20px;border-radius:12px;box-shadow:var(--shadow);max-width:600px}
.quick-order input,.quick-order select,.quick-order textarea{padding:10px;border:1px solid rgba(2,6,23,0.15);border-radius:8px;width:100%}
.quick-order button{justify-self:start}

/* Feed */
.feed-grid{display:grid;grid-template-columns:30% 70%;gap:20px}
.feed-grid>div{background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--shadow)}

/* Responsive */
@media(max-width:900px){
  nav ul{display:none}
  .menu-toggle{display:inline-block}
  .slide-content{flex-direction:column;text-align:center}
  .gallery-slide{min-width:220px}
  .testimonial-card{min-width:260px}
  .feed-grid{grid-template-columns:1fr;gap:16px}
}

</style>
</head>
<body>
<!-- promo -->
<div class="promo-marquee" id="promoBar"><marquee id="promoText" behavior="scroll" direction="left">üî• FLASH SALE Hari ini ‚Äî Tersisa 3 item lagi! üî•</marquee></div>

<!-- header -->
<header>
  <button class="menu-toggle" onclick="toggleMenu()" aria-label="Buka menu">‚ò∞</button>
  <div class="logo"><img id="siteLogo" src="assets/logo.png" alt="Navid Snack logo"/><span id="siteBrand">Navid Snack</span></div>
  <nav>
    <ul>
      <li><a href="#hero">Beranda</a></li>
      <li><a href="#products">Produk</a></li>
      <li><a href="#gallery">Galeri</a></li>
      <li><a href="#testimonials">Testimoni</a></li>
      <li><a href="#feed">Feed</a></li>
      <li><a href="#contact">Kontak</a></li>
    </ul>
  </nav>
  <button class="btn-toggle" onclick="toggleDarkMode()" aria-pressed="false" title="Toggle dark mode">üåô</button>
</header>

<!-- side menu -->
<div id="sideMenu" class="side-menu" aria-hidden="true">
  <button class="close-btn" onclick="toggleMenu()" aria-label="Tutup">√ó</button>
  <ul>
    <li><a href="#hero" onclick="toggleMenu()">Beranda</a></li>
    <li><a href="#products" onclick="toggleMenu()">Produk</a></li>
    <li><a href="#gallery" onclick="toggleMenu()">Galeri</a></li>
    <li><a href="#testimonials" onclick="toggleMenu()">Testimoni</a></li>
    <li><a href="#feed" onclick="toggleMenu()">Feed</a></li>
    <li><a href="#contact" onclick="toggleMenu()">Kontak</a></li>
  </ul>
</div>

<!-- HERO -->
<section id="hero">
  <button class="arrow arrow-left" onclick="prevSlide()" aria-label="Sebelumnya">‚ùÆ</button>
  <button class="arrow arrow-right" onclick="nextSlide()" aria-label="Berikutnya">‚ùØ</button>

  <!-- slides will be rendered here -->
  <div id="slidesContainer"></div>

  <div class="dots" id="heroDots"></div>
</section>

<!-- PRODUCTS -->
<section id="products" class="container" aria-labelledby="productsTitle">
  <div class="section-title"><h2 id="productsTitle">Produk Unggulan</h2></div>
  <div class="products-grid" id="productsGrid"></div>
</section>

<!-- GALLERY -->
<section id="gallery" class="container" aria-labelledby="galleryTitle">
  <div class="section-title"><h2 id="galleryTitle">Galeri Produk</h2></div>
  <div class="gallery-slider" id="gallerySlider">
    <div class="gallery-track" id="galleryTrack"></div>
  </div>
</section>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
  <button class="nav-btn prev" onclick="prevGallery()" aria-label="Sebelumnya">‚ùÆ</button>
  <img id="lightboxImg" alt="Preview"/>
  <button class="nav-btn next" onclick="nextGallery()" aria-label="Berikutnya">‚ùØ</button>
  <button class="close-light" onclick="closeLightbox()" aria-label="Tutup">√ó</button>
</div>

<!-- TESTIMONIAL -->
<section id="testimonials" class="container" aria-labelledby="testiTitle">
  <div class="section-title"><h2 id="testiTitle">Testimoni Pelanggan</h2></div>
  <div class="testimonial-wrap">
    <div style="overflow:hidden">
      <div id="testiTrack" class="testimonial-track"></div>
    </div>
    <div class="testimonial-nav" style="margin-top:12px">
      <button class="btn" onclick="testiPrev()">‚ùÆ</button>
      <button class="btn" onclick="testiNext()">‚ùØ</button>
    </div>
  </div>
</section>

<!-- QUICK ORDER FORM -->
<section class="container" aria-labelledby="quickOrderTitle" style="margin-top:18px">
  <div class="section-title"><h2 id="quickOrderTitle">Form Pemesanan Cepat</h2></div>
  <form id="quickOrderForm" class="quick-order" onsubmit="submitQuickOrder(event)">
    <input id="qName" type="text" placeholder="Nama lengkap" required aria-label="Nama"/>
    <input id="qWA" type="tel" placeholder="Nomor WhatsApp (contoh: 0812...)" required aria-label="Nomor WA"/>
    <input id="qAddr" type="text" placeholder="Alamat (kelurahan/kota)" required aria-label="Alamat"/>
    <select id="qProduct" required aria-label="Pilih produk"></select>
    <input id="qQty" type="number" min="1" value="1" required aria-label="Jumlah"/>
    <textarea id="qNote" rows="2" placeholder="Catatan / request (opsional)"></textarea>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="btn" type="submit">Kirim ke WhatsApp Admin</button>
      <small style="color:var(--muted)">Subtotal akan disertakan sebelum ongkir</small>
    </div>
  </form>
</section>

<!-- floating elements -->
<button class="floating-cart" id="floatingCart" onclick="toggleCart()" aria-label="Buka keranjang">üõí<span class="cart-badge" id="cartBadge">0</span></button>
<div class="whatsapp-float" title="Chat via WhatsApp"><a id="waLink" href="#" target="_blank" rel="noreferrer"><img src="https://img.icons8.com/color/96/whatsapp.png" alt="WhatsApp Navid Snack"/></a></div>
<button class="scroll-top" id="scrollTopBtn" onclick="scrollToTop()" aria-label="Kembali ke atas">‚Üë</button>

<!-- cart panel -->
<aside id="cartPanel" class="cart-panel" aria-label="Keranjang belanja">
  <button class="close-cart" onclick="toggleCart()">√ó</button>
  <h3>Keranjang</h3>
  <div id="cartItems" style="margin-top:14px"></div>
  <p style="margin-top:12px"><strong>Subtotal:</strong> Rp <span id="cartTotal">0</span></p>
  <p style="font-size:13px;color:var(--muted)">Belum termasuk ongkir</p>
  <div style="display:flex;gap:8px;margin-top:12px">
    <button class="btn" onclick="checkout()">Checkout via WhatsApp</button>
    <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="clearCart()">Bersihkan</button>
  </div>
</aside>

<!-- product modal -->
<div id="productModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1500">
  <div style="background:var(--bg);padding:18px;border-radius:10px;max-width:520px;width:calc(100% - 40px);position:relative">
    <button onclick="closeProductModal()" style="position:absolute;top:10px;right:12px;background:none;border:none;font-size:22px;cursor:pointer">√ó</button>
    <img id="modalImg" src="" alt="Detail produk" style="width:100%;height:300px;object-fit:cover;border-radius:8px;margin-bottom:10px">
    <h3 id="modalName"></h3>
    <p id="modalDesc" style="color:var(--muted)"></p>
    <p id="modalPrice" style="font-weight:800;color:var(--danger)"></p>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" onclick="addToCartFromModal()">Tambah ke Keranjang</button>
      <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="closeProductModal()">Tutup</button>
    </div>
  </div>
</div>

<!-- feed (instagram + youtube) -->
<section id="feed" class="container" aria-labelledby="feedTitle">
  <div class="section-title"><h2 id="feedTitle">Media Sosial</h2></div>
  <div class="feed-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
    <div class="feed-ig" style="background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--shadow)">
      <h3 style="margin-bottom:10px;color:var(--brand)">Instagram</h3>
      <div id="igEmbedContainer"></div>
    </div>
    <div class="feed-yt" style="background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--shadow)">
      <h3 style="margin-bottom:10px;color:var(--brand)">YouTube</h3>
      <div class="yt-wrapper">
        <iframe id="ytFrame" src="" title="Navid Snack YouTube" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" style="width:100%;height:315px;border-radius:12px"></iframe>
      </div>
    </div>
  </div>
</section>

<!-- footer -->
<footer id="contact">
  <div class="footer-grid" style="display:flex;gap:20px;flex-wrap:wrap;max-width:var(--maxw);margin:0 auto;padding:28px;background:#08101a;color:#fff">
    <div class="footer-info" style="flex:1 1 320px">
      <h3 id="footerBrand">Navid Snack</h3>
      <p id="footerAddr">Alamat: Deket, Lamongan, Jawa Timur</p>
      <p id="footerPhone">Telp: +62 812-3456-7890</p>
      <p style="margin-top:8px"><strong>Certificate:</strong></p>
      <div id="certRow" style="display:flex;gap:8px;align-items:center;margin-top:8px"></div>
    </div>
    <div class="footer-map" style="flex:1 1 320px">
      <h4>Lokasi</h4>
      <iframe id="mapFrame" src="https://www.google.com/maps/embed?pb=!1m18!..." style="width:100%;height:220px;border:0;border-radius:10px" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="Lokasi Navid Snack"></iframe>
    </div>
  </div>
</footer>

<!-- toast placeholder -->
<div id="toastPlace"></div>

<!-- Instagram embed script (official) -->
<script async defer src="//www.instagram.com/embed.js"></script>

<!-- load data.js first (you uploaded it as data.js) -->
<script src="js/data.js"></script>

<script>
/* =============
   MAIN SCRIPT
   - uses window.SITE, window.SLIDES, window.PRODUCTS, window.GALLERY, window.TESTIMONIALS, window.NOTIFIKASI
   ============= */

const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));

/* -------------------------
   Update head/meta from SITE
   -------------------------*/
function applySiteMeta(){
  if(!window.SITE) return;
  const site = window.SITE;
  const brand = site.brand || document.title;
  $('#pageTitle').textContent = brand + (brand.includes('Navid')? '' : ' ‚Äî Navid Snack');
  $('#metaDescription').setAttribute('content', site.description || '');
  $('#metaKeywords').setAttribute('content', site.keywords || '');
  $('#siteBrand').textContent = site.brand || 'Navid Snack';
  $('#footerBrand').textContent = site.brand || 'Navid Snack';
  $('#siteLogo').src = site.img || $('#siteLogo').src;
  $('#favicon').href = site.img || $('#favicon').href;
  $('#waLink').href = site.wa ? `https://wa.me/${site.wa}` : $('#waLink').href;
  $('#footerAddr').textContent = 'Alamat: ' + (site.alamat || '');

  const certRow = $('#certRow');
  certRow.innerHTML = '';
  (site.sertifikat || []).forEach(c=>{
    const img = document.createElement('img');
    img.src = c.src; img.alt = c.alt; img.style.height='40px'; img.style.borderRadius='6px'; img.loading = 'lazy';
    certRow.appendChild(img);
  });

  $('#ogTitle').setAttribute('content', site.brand || document.title);
  $('#ogDesc').setAttribute('content', site.description || '');
  $('#ogImage').setAttribute('content', site.img || '');
}

/* ======================
   HERO SLIDER
   ====================== */
let slides = [], dots = [], slideCur = 0, slideTimer = null;
function renderHero(){
  const container = $('#slidesContainer');
  const dotsWrap = $('#heroDots');
  container.innerHTML = '';
  dotsWrap.innerHTML = '';
  (window.SLIDES || []).forEach((s,i)=>{
    const slide = document.createElement('div');
    slide.className = 'slide' + (i===0?' active':'');
    slide.style.backgroundImage = `url('${s.bg}')`;
    slide.innerHTML = `
      <div class="slide-content">
        <img src="${s.img}" alt="${s.title}" loading="lazy"/>
        <div class="slide-text">
          <h1>${s.title}</h1>
          <p>${s.text || ''}</p>
          ${ s.cta ? `<div class="hero-cta"><a href="${s.cta.link}" class="btn">${s.cta.text}</a></div>` : '' }
        </div>
      </div>`;
    container.appendChild(slide);
    const dot = document.createElement('span');
    dot.className = 'dot' + (i===0?' active':'');
    dot.addEventListener('click', ()=> showSlide(i));
    dotsWrap.appendChild(dot);
  });
  slides = $$('.slide'); dots = $$('.dot'); slideCur = 0;
  if(slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(nextSlide, 6000);
}
function showSlide(n){ slideCur = (n+slides.length)%slides.length; slides.forEach((s,i)=>s.classList.toggle('active',i===slideCur)); dots.forEach((d,i)=>d.classList.toggle('active',i===slideCur)); }
function nextSlide(){ showSlide(slideCur+1) }
function prevSlide(){ showSlide(slideCur-1) }

/* ====== SIDE MENU ====== */
function toggleMenu(){
  const menu = $('#sideMenu');
  const isActive = menu.classList.toggle('active');
  menu.setAttribute('aria-hidden', !isActive);
}
document.addEventListener('click', (e)=>{
  const side = $('#sideMenu');
  if(!e.target.closest('.menu-toggle') && side.classList.contains('active') && !e.target.closest('.side-menu')){
    side.classList.remove('active'); side.setAttribute('aria-hidden','true');
  }
});

/* ====== DARK MODE ====== */
function applyDarkModeFromStorage(){
  const val = localStorage.getItem('navid_darkmode');
  if(val==='1') document.body.classList.add('dark-mode');
  else document.body.classList.remove('dark-mode');
  $$('.btn-toggle').forEach(b=>b.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô');
}
function toggleDarkMode(){
  document.body.classList.toggle('dark-mode');
  const active = document.body.classList.contains('dark-mode');
  localStorage.setItem('navid_darkmode', active?'1':'0');
  $$('.btn-toggle').forEach(b=>b.textContent = active ? '‚òÄÔ∏è':'üåô');
}

/* ============================
   PRODUCTS + COUNTDOWN PROMO
   ============================ */
function formatRupiah(v){ if(!v) return ''; return 'Rp ' + Number(v).toLocaleString('id-ID'); }

function isPromoActive(p){
  const now = new Date();
  let startDate = p.tglPromoStart? new Date(p.tglPromoStart+'T00:00') : null;
  let endDate = p.tglPromoEnd? new Date(p.tglPromoEnd+'T23:59') : null;
  if(p.tglPromoStart && !p.tglPromoEnd) endDate = new Date(p.tglPromoStart+'T23:59');

  // jika hanya jam
  if(!p.tglPromoStart && !p.tglPromoEnd && p.jamPromoStart && p.jamPromoEnd){
    const [sh,sm] = p.jamPromoStart.split(':').map(Number);
    const [eh,em] = p.jamPromoEnd.split(':').map(Number);
    const start = new Date(); start.setHours(sh,sm,0,0);
    const end = new Date(); end.setHours(eh,em,0,0);
    if(end < start) end.setDate(end.getDate()+1); // melewati tengah malam
    return now>=start && now<=end;
  }

  if(startDate && endDate){
    if(now<startDate || now>endDate) return false;
    // jika ada jam juga
    if(p.jamPromoStart && p.jamPromoEnd){
      const [sh,sm] = p.jamPromoStart.split(':').map(Number);
      const [eh,em] = p.jamPromoEnd.split(':').map(Number);
      const start = new Date(now); start.setHours(sh,sm,0,0);
      const end = new Date(now); end.setHours(eh,em,0,0);
      if(end < start) end.setDate(end.getDate()+1);
      return now>=start && now<=end;
    }
    return true;
  }
  return false;
}

function renderProducts(){
  const grid = $('#productsGrid');
  grid.innerHTML = '';
  (window.PRODUCTS || []).forEach(p=>{
    const art = document.createElement('article');
    art.className = 'card';
    const active = isPromoActive(p);
    art.innerHTML = `
      <div class="img-wrapper">
        <img src="${p.img}" alt="${p.name}" loading="lazy" onclick="openProductModal(this)">
        ${active ? '<div class="promo-label">PROMO</div>' : ''}
        ${active ? `<div class="countdown-overlay" data-cid></div>` : ''}
      </div>
      <h3>${p.name}</h3>
      <div class="price-row">
        <span class="price-old">${p.oldPrice? formatRupiah(p.oldPrice) : ''}</span>
        <span class="price-new">${formatRupiah(p.price)}</span>
      </div>
      <div class="stars">${'‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ'.slice(0, p.rating || 5)}</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
        <button class="btn" onclick="addToCart(this)">Tambah ke Keranjang</button>
        <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--brand)" onclick="quickOrderPref('${escapeQuotes(p.name)}',${p.price})">Pesan Cepat</button>
      </div>
    `;
    grid.appendChild(art);
    if(active) startCountdown(art.querySelector('[data-cid]'), p);
  });

  const qSel = $('#qProduct');
  qSel.innerHTML = '<option value="">Pilih produk...</option>';
  (window.PRODUCTS||[]).forEach(p=> qSel.insertAdjacentHTML('beforeend', `<option value="${p.name}|${p.price}">${p.name} - ${formatRupiah(p.price)}</option>`));
}

function startCountdown(el, p){
  function update(){
    const now = new Date();
    let end = p.tglPromoEnd? new Date(p.tglPromoEnd+'T23:59') : p.tglPromoStart? new Date(p.tglPromoStart+'T23:59') : null;
    if(p.jamPromoEnd){
      const [eh,em] = p.jamPromoEnd.split(':').map(Number);
      end = new Date(); end.setHours(eh,em,0,0);
      if(p.jamPromoStart && p.jamPromoEnd){
        const [sh,sm] = p.jamPromoStart.split(':').map(Number);
        const start = new Date(); start.setHours(sh,sm,0,0);
        if(end<start) end.setDate(end.getDate()+1);
      }
    }
    if(!end || now>end){ el.textContent='Promo berakhir'; return; }
    const diff = end-now;
    if(diff<=0){ el.textContent='Promo berakhir'; return; }
    const h = Math.floor(diff/3600000);
    const m = Math.floor((diff%3600000)/60000);
    const s = Math.floor((diff%60000)/1000);
    el.textContent = `Berakhir: ${h}j ${m}m ${s}d`;
  }
  update(); setInterval(update,1000);
}

function escapeQuotes(s){ return (s||'').replace(/'/g,"\\'").replace(/"/g,'&quot;'); }

/* ============================
   CART (localStorage)
   ============================ */
let cart=[]; const floatingCartBtn=$('#floatingCart'),cartBadge=$('#cartBadge'),cartItemsWrap=$('#cartItems'),cartTotalEl=$('#cartTotal');
function loadCartFromStorage(){ try{cart=JSON.parse(localStorage.getItem('navid_cart')||'[]')}catch{cart=[]} renderCart(); floatingCartBtn.style.display = cart.length?'flex':'none'; }
function saveCartToStorage(){ localStorage.setItem('navid_cart', JSON.stringify(cart)); }
function addToCart(btn){ addProductToCartFromCard(btn.closest('.card')); }
function addProductToCartFromCard(card){
  const name=card.querySelector('h3').textContent, price=Number(card.dataset.price||0)||Number(card.getAttribute('data-price')||0)||Number(card.dataset.price||0)||0;
  let found=cart.find(x=>x.name===name); if(found) found.qty++; else cart.push({name,price,qty:1,stock:99});
  saveCartToStorage(); renderCart(); floatingCartBtn.style.display='flex'; showToast(name+' ditambahkan');
}
function renderCart(){ if(!cartItemsWrap) return; cartItemsWrap.innerHTML=''; let total=0;
  cart.forEach((it,i)=>{ total+=it.price*it.qty; cartItemsWrap.insertAdjacentHTML('beforeend',`
  <div class="cart-item" style="padding:10px 0">
    <strong>${it.name}</strong><div style="margin-top:6px">Rp ${it.price.toLocaleString('id-ID')} 
    <button onclick="decQty(${i})">-</button>
    <input type="number" value="${it.qty}" min="1" style="width:56px" onchange="setQty(${i}, this.value)">
    <button onclick="incQty(${i})">+</button> = <strong>Rp ${(it.price*it.qty).toLocaleString('id-ID')}</strong>
    <button style="float:right;background:transparent;border:none;color:var(--danger)" onclick="removeItem(${i})">Hapus</button></div>
  </div>`); });
  cartTotalEl.textContent=total.toLocaleString('id-ID'); cartBadge.textContent = cart.reduce((s,i)=>s+i.qty,0);
}
function incQty(i){ cart[i].qty++; saveCartToStorage(); renderCart(); }
function decQty(i){ if(cart[i].qty>1) cart[i].qty--; saveCartToStorage(); renderCart(); }
function setQty(i,v){ let q=Number(v); if(isNaN(q)||q<1) q=1; cart[i].qty=q; saveCartToStorage(); renderCart(); }
function removeItem(i){ cart.splice(i,1); saveCartToStorage(); renderCart(); if(cart.length===0) floatingCartBtn.style.display='none'; }
function toggleCart(){ $('#cartPanel').classList.toggle('active'); }

/* CHECKOUT via WA */
function checkout(){ if(!cart.length) return; let msg='Halo, saya ingin pesan:%0A'; let total=0; cart.forEach(it=>{msg+=`${it.name} x${it.qty} = Rp${(it.price*it.qty).toLocaleString('id-ID')}%0A`;total+=it.price*it.qty}); msg+=`Total: Rp${total.toLocaleString('id-ID')}`; const wa=(window.SITE&&window.SITE.wa)||'6281234567890'; window.open('https://wa.me/'+wa+'?text='+encodeURIComponent(msg)); }

/* QUICK ORDER */
function quickOrderPref(name,price){ $('#qProduct').value=`${name}|${price}`; $('#qQty').value=1; $('#qName').focus(); window.scrollTo({top:$('#quickOrderForm').offsetTop-80,behavior:'smooth'}); }

/* TOAST */
function showToast(text){ const t=document.createElement('div'); t.className='toast'; t.textContent=text; $('#toastPlace').appendChild(t); setTimeout(()=>t.remove(),3000); }

/* GALLERY */
function renderGallery(){ const g=window.GALLERY||[]; const track=$('#galleryTrack'); track.innerHTML=''; g.concat(g).forEach((x,i)=>track.insertAdjacentHTML('beforeend',`<div class="gallery-slide"><img src="${x.src}" loading="lazy" onclick="openLightboxByIndex(${i%g.length})"></div>`)); }
function openLightboxByIndex(i){ const imgs=(window.GALLERY||[]).map(g=>g.src); $('#lightboxImg').src=imgs[i]; $('#lightbox').style.display='flex'; }
function closeLightbox(){ $('#lightbox').style.display='none'; }

/* TESTIMONI */
function renderTestimonials(){ const t=window.TESTIMONIALS||[]; const track=$('#testiTrack'); track.innerHTML=''; t.concat(t).forEach(s=>track.insertAdjacentHTML('beforeend',`<div class="testimonial-card"><img src="${s.img}" alt="${s.name}"><p><strong>${s.name}</strong></p><p>"${s.text}"</p></div>`)); }

/* INIT */
window.addEventListener('DOMContentLoaded',()=>{
  applySiteMeta(); renderHero(); renderProducts(); renderGallery(); renderTestimonials();
  applyDarkModeFromStorage(); loadCartFromStorage();
});
</script>

</body>
</html>
