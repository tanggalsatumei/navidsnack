<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="pageTitle">Navid Snack</title>
<meta name="description" id="metaDescription" content="Camilan sehat & lezat dari Lamongan. Pesan cepat via WhatsApp."/>
<meta name="keywords" id="metaKeywords" content="navid snack, camilan lamongan, keripik pisang, kacang gurih, snack sehat"/>

<meta property="og:title" id="ogTitle" content="Navid Snack"/>
<meta property="og:description" id="ogDesc" content="Camilan sehat & lezat dari Lamongan. Pesan cepat via WhatsApp."/>
<meta property="og:image" id="ogImage" content="assets/logo.png"/>
<meta property="og:type" content="website"/>

<link rel="icon" id="favicon" href="assets/logo.png" type="image/png"/>

<style>
:root{
  --bg:#fff;--surface:#fbfaf8;--muted:#7b7b7b;--text:#17202a;
  --brand:#0f1724;--accent:#ffb703;--accent-2:#fb8500;--soft:#f4f1ea;
  --success:#2d6a4f;--danger:#d00000;--glass:rgba(255,255,255,0.7);
  --radius:12px;--shadow:0 8px 24px rgba(17,24,39,0.08);--maxw:1200px;
}
/* DARK MODE variables override everything */
body.dark-mode{
  --bg:#071127;--surface:#0f1724;--muted:#95a3b3;--text:#e6eef4;
  --brand:#081224;--accent:#ffb703;--accent-2:#ff9f1c;--soft:#071226;
  --shadow:0 8px 30px rgba(0,0,0,0.6);
}

html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
a{color:inherit}

/* PROMO MARQUEE - ngejreng */
.promo-marquee{
  background: linear-gradient(90deg,#ff2d2d,#ff7a00);
  color:#fff;font-weight:800;padding:8px 0;font-size:15px;text-align:center;
  text-shadow:0 2px 6px rgba(0,0,0,0.25);
  position:sticky;top:0;z-index:1400;
}

/* Header */
header{position:sticky;top:40px;z-index:1200;display:flex;align-items:center;gap:16px;padding:12px 20px;background:linear-gradient(180deg,var(--brand),#0b1220);color:var(--accent);box-shadow:0 2px 10px rgba(0,0,0,0.12)}
.logo{display:flex;align-items:center;gap:10px}
.logo img{width:40px;height:40px;border-radius:8px;background:var(--soft);padding:4px}
nav{margin-left:auto}
nav ul{display:flex;gap:18px;list-style:none;margin:0;padding:0}
nav a{color:var(--accent);text-decoration:none;font-weight:600}
.menu-toggle{display:none;background:none;border:1px solid rgba(255,255,255,0.08);color:var(--accent);padding:8px;border-radius:8px;cursor:pointer}
.btn-toggle{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--accent);padding:8px 10px;border-radius:10px;cursor:pointer}

/* HERO slider */
#hero{position:relative;height:65vh;min-height:320px;overflow:hidden;border-bottom:1px solid rgba(0,0,0,0.05)}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .5s ease}
.slide.active{opacity:1}
.slide::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.44),rgba(0,0,0,0.08))}
.slide-content{position:relative;z-index:2;max-width:var(--maxw);margin:0 auto;padding:28px;color:#fff;display:flex;gap:20px;align-items:center;justify-content:center;text-align:center;flex-direction:column}
.hero-title{font-size:28px;margin:0;padding:0}
.arrow{position:absolute;background:rgba(0,0,0,0.45);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
.arrow-left{left:18px;top:50%;transform:translateY(-50%)}
.arrow-right{right:18px;top:50%;transform:translateY(-50%)}
.dots{position:absolute;bottom:14px;width:100%;text-align:center}
.dot{display:inline-block;width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.6);margin:0 6px;cursor:pointer}
.dot.active{background:var(--accent)}

/* Layout main container */
.container{max-width:var(--maxw);margin:0 auto;padding:28px}

/* Products */
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
.card{background:var(--surface);padding:14px;border-radius:12px;box-shadow:var(--shadow);position:relative}
.card img{width:100%;height:220px;object-fit:cover;border-radius:10px;display:block}
.card h3{margin:8px 0 6px 0}
.card p{color:var(--muted);margin:0 0 8px 0}
.price-row{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0}
.price-old{text-decoration:line-through;color:var(--muted);font-size:13px}
.price-new{color:var(--danger);font-weight:800}
.promo-label{position:absolute;top:12px;left:12px;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#fff;padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px}
.countdown-overlay{margin-top:6px;color:var(--success);font-weight:700;text-align:center}

/* Gallery & Testimonial slider */
.gallery-slider,.testimonial-wrap{position:relative;overflow:hidden;margin-top:12px}
.gallery-track,.testimonial-track{display:flex;transition:transform .45s ease;will-change:transform}
.gallery-slide,.testimonial-card{min-width:260px;margin:8px;background:var(--surface);border-radius:12px;box-shadow:var(--shadow);flex-shrink:0;padding:8px;text-align:center}
.gallery-slide img,.testimonial-card img{width:100%;height:200px;object-fit:cover;border-radius:10px}
.slider-arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.45);color:#fff;border:none;padding:10px;border-radius:10px;cursor:pointer;z-index:20}
.slider-left{left:8px}.slider-right{right:8px}

/* Lightbox */
.lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.86);z-index:1600}
.lightbox img{max-width:92%;max-height:86%;border-radius:12px;box-shadow:0 20px 50px rgba(0,0,0,0.6)}
.lightbox .btn{position:absolute;background:none;border:none;color:#fff;font-size:32px;cursor:pointer}
.lightbox .prev{left:18px}.lightbox .next{right:18px}.lightbox .close{top:18px;right:26px;font-size:40px}

/* Quick order form */
.quick-order{background:var(--surface);padding:20px;border-radius:12px;box-shadow:var(--shadow);color:var(--text)}
.quick-order-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:8px}
.quick-order input, .quick-order select, .quick-order textarea{width:100%;padding:10px;border:1px solid rgba(15,23,36,0.06);border-radius:8px;font-size:15px;background:transparent;color:var(--text)}
.quick-order button{background:var(--accent);border:none;color:var(--brand);padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer}
.quick-order small{color:var(--muted)}

/* Feed grid IG 30% YT 70% */
.feed-grid{display:grid;grid-template-columns:30% 70%;gap:20px}

/* Footer */
footer{background:#08101a;color:#fff;padding:28px;margin-top:18px;border-top:4px solid rgba(255,183,3,0.06)}

/* Responsive */
@media(max-width:900px){
  .slide-content{padding:18px}
  .card img{height:180px}
  .gallery-slide,.testimonial-card{min-width:220px}
}
@media(max-width:700px){
  nav ul{display:none}
  .menu-toggle{display:inline-block}
  #hero{height:48vh;min-height:250px}
  .arrow-left,.arrow-right{top:auto;bottom:8px;transform:none;padding:8px;opacity:0.95}
  .arrow-left{left:8px}.arrow-right{right:8px}
  .feed-grid{grid-template-columns:1fr}
  .quick-order-row{grid-template-columns:1fr}
  .promo-marquee{font-size:14px}
}
</style>
</head>
<body>

<!-- Marquee -->
<div class="promo-marquee"><marquee behavior="scroll" direction="left" id="promoText">üî• PROMO SPESIAL ‚Äî Diskon hingga 50% Hari Ini üî•</marquee></div>

<!-- Header -->
<header>
  <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
  <div class="logo"><img id="siteLogo" src="assets/logo.png" alt="logo"><div id="siteBrand" style="color:var(--accent);font-weight:800">Navid Snack</div></div>
  <nav><ul><li><a href="#products">Produk</a></li><li><a href="#gallery">Galeri</a></li><li><a href="#testi">Testimoni</a></li><li><a href="#feed">Feed</a></li></ul></nav>
  <button class="btn-toggle" onclick="toggleDarkMode()" id="darkBtn">üåô</button>
</header>

<!-- HERO -->
<section id="hero">
  <button class="arrow arrow-left" onclick="prevSlide()" aria-label="Prev">‚ùÆ</button>
  <button class="arrow arrow-right" onclick="nextSlide()" aria-label="Next">‚ùØ</button>
  <div id="slidesContainer"></div>
  <div class="dots" id="heroDots"></div>
</section>

<!-- PRODUCTS -->
<section id="products" class="container">
  <h2>Produk Unggulan</h2>
  <div id="productsGrid" class="products-grid"></div>
</section>

<!-- GALLERY -->
<section id="gallery" class="container">
  <h2>Galeri</h2>
  <div class="gallery-slider">
    <button class="slider-arrow slider-left" onclick="galleryPrev()">‚ùÆ</button>
    <div class="gallery-track" id="galleryTrack" tabindex="0"></div>
    <button class="slider-arrow slider-right" onclick="galleryNext()">‚ùØ</button>
  </div>
</section>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" aria-hidden="true">
  <button class="btn prev" onclick="lightboxPrev()" aria-label="Prev">‚ùÆ</button>
  <img id="lightboxImg" alt="Preview">
  <button class="btn next" onclick="lightboxNext()" aria-label="Next">‚ùØ</button>
  <button class="btn close" onclick="closeLightbox()" aria-label="Close">√ó</button>
</div>

<!-- TESTIMONIAL -->
<section id="testi" class="container">
  <h2>Testimoni</h2>
  <div class="testimonial-wrap">
    <button class="slider-arrow slider-left" onclick="testiPrev()">‚ùÆ</button>
    <div class="testimonial-track" id="testiTrack"></div>
    <button class="slider-arrow slider-right" onclick="testiNext()">‚ùØ</button>
  </div>
</section>

<!-- QUICK ORDER -->
<section class="container">
  <h2>Form Pemesanan Cepat</h2>
  <form id="quickOrderForm" class="quick-order" onsubmit="submitQuickOrder(event)">
    <div class="quick-order-row">
      <input id="qName" placeholder="Nama lengkap" required>
      <input id="qWA" placeholder="Nomor WhatsApp (0812...)" required>
    </div>
    <input id="qAddr" placeholder="Alamat lengkap (kel/kec/kota)" required>
    <select id="qProduct" required></select>
    <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
      <input id="qQty" type="number" min="1" value="1" required style="width:110px">
      <button type="submit">Pesan via WhatsApp</button>
      <small style="margin-left:auto;color:var(--muted)">Subtotal akan dihitung saat checkout</small>
    </div>
    <textarea id="qNote" placeholder="Catatan / permintaan (opsional)" style="margin-top:10px"></textarea>
  </form>
</section>

<!-- FEED -->
<section id="feed" class="container">
  <h2>Media Sosial</h2>
  <div class="feed-grid">
    <div class="feed-ig">
      <h3>Instagram</h3>
      <div id="igEmbedContainer"></div>
    </div>
    <div class="feed-yt">
      <h3>YouTube</h3>
      <iframe id="ytFrame" src="" title="YouTube" style="width:100%;height:320px;border-radius:12px;border:0;"></iframe>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div style="max-width:var(--maxw);margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:20px">
    <div>
      <h3 id="footerBrand" style="margin:0">Navid Snack</h3>
      <p id="footerAddr" style="margin:6px 0 0 0;color:var(--muted)">Deket, Lamongan, Jawa Timur</p>
    </div>
    <div>&copy; <span id="yr"></span> Navid Snack</div>
  </div>
</footer>

<!-- load data.js (you must provide this) -->
<script src="js/data.js"></script>

<script>
/* ----------------------
   Utilities & initial
   ---------------------- */
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));
document.getElementById('yr').textContent = new Date().getFullYear();

/* Apply SITE meta if available */
function applySiteMeta(){
  if(!window.SITE) return;
  const s = window.SITE;
  $('#pageTitle').textContent = s.brand || $('#pageTitle').textContent;
  $('#metaDescription').setAttribute('content', s.description || '');
  $('#metaKeywords').setAttribute('content', s.keywords || '');
  $('#siteLogo').src = s.img || $('#siteLogo').src;
  $('#favicon').href = s.img || $('#favicon').href;
  $('#ogImage').setAttribute('content', s.img || $('#ogImage').getAttribute('content'));
  $('#ogTitle').setAttribute('content', s.brand || $('#ogTitle').getAttribute('content'));
  $('#ogDesc').setAttribute('content', s.description || $('#ogDesc').getAttribute('content'));
  if(s.wa) {
    // optional: set WA links used by checkout
    window._SITE_WA = s.wa;
  }
}

/* ----------------------
   DARK MODE (persist)
   ---------------------- */
function toggleDarkMode(){
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('navid_darkmode', document.body.classList.contains('dark-mode')? '1':'0');
  $('#darkBtn').textContent = document.body.classList.contains('dark-mode')? '‚òÄÔ∏è':'üåô';
}
if(localStorage.getItem('navid_darkmode')==='1'){ document.body.classList.add('dark-mode'); $('#darkBtn').textContent='‚òÄÔ∏è'; }

/* ----------------------
   HERO SLIDER
   ---------------------- */
let slideIndex = 0, slideTimer = null;
function renderHero(){
  const slides = window.SLIDES || [];
  const container = $('#slidesContainer'); const dots = $('#heroDots');
  container.innerHTML = ''; dots.innerHTML = '';
  if(!slides.length) return;
  slides.forEach((s,i)=>{
    const el = document.createElement('div');
    el.className = 'slide' + (i===0 ? ' active' : '');
    el.style.backgroundImage = `url('${s.bg}')`;
    el.innerHTML = `<div class="slide-content"><h2 class="hero-title">${s.title||''}</h2><p>${s.text||''}</p>${s.cta?`<div style="margin-top:10px"><a href="${s.cta.link}" class="btn" style="background:var(--accent);color:#071123;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:800">${s.cta.text}</a></div>`:''}</div>`;
    container.appendChild(el);
    const dot = document.createElement('span'); dot.className = 'dot' + (i===0?' active':''); dot.onclick = ()=> showSlide(i);
    dots.appendChild(dot);
  });
  slideIndex = 0;
  if(slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(()=> showSlide(slideIndex+1), 6000);
}
function showSlide(i){
  const slides = $$('.slide'); const dots = $$('.dot');
  if(!slides.length) return;
  slideIndex = (i + slides.length) % slides.length;
  slides.forEach((sl,idx)=> sl.classList.toggle('active', idx===slideIndex));
  dots.forEach((d,idx)=> d.classList.toggle('active', idx===slideIndex));
}
function nextSlide(){ showSlide(slideIndex+1) }
function prevSlide(){ showSlide(slideIndex-1) }

/* ----------------------
   PROMO LOGIC & COUNTDOWN
   Specification:
   - fields: tglPromoStart, tglPromoEnd, jamPromoStart, jamPromoEnd
   - If only tglPromoStart present, treat as single-day full-day promo (00:00-23:59)
   - If only jamPromoStart/jamPromoEnd present, treat as daily recurring promo at those hours
   - If jamPromoStart > jamPromoEnd => spans midnight
   ---------------------- */

/* normalize helper: returns minutes since midnight */
function minutesOf(hm){
  if(!hm) return null;
  const [h,m] = hm.split(':').map(x=>Number(x||0));
  return (h*60 + m);
}
function parseDateOnly(d){
  if(!d) return null;
  // expect YYYY-MM-DD
  const parts = d.split('-').map(Number);
  if(parts.length<3) return null;
  return new Date(parts[0], parts[1]-1, parts[2], 0, 0, 0, 0);
}

/* determine if product is currently in promo */
function isInPromo(p){
  try{
    // If promo flag false => no
    if(!p.promo) return false;
    const now = new Date();
    const nowMinutes = now.getHours()*60 + now.getMinutes();

    // 1) Date window check
    if(p.tglPromoStart){
      const startDate = parseDateOnly(p.tglPromoStart);
      const endDate = parseDateOnly(p.tglPromoEnd || p.tglPromoStart);
      // set end to end of day
      endDate.setHours(23,59,59,999);
      if(now < startDate || now > endDate) return false;
    }

    // 2) Time-of-day check
    if(p.jamPromoStart || p.jamPromoEnd){
      // if either missing, assume full day
      const startMin = minutesOf(p.jamPromoStart || '00:00');
      const endMin = minutesOf(p.jamPromoEnd || '23:59');
      if(startMin <= endMin){
        if(nowMinutes < startMin || nowMinutes > endMin) return false;
      }else{
        // spans midnight, e.g. 23:00 - 01:00 => valid if now >= startMin OR now <= endMin
        if(!(nowMinutes >= startMin || nowMinutes <= endMin)) return false;
      }
    }
    // 3) Edge: if no date and no time provided but p.promo true => treat as always promo
    return true;
  }catch(e){
    return false;
  }
}

/* Update countdown display for each product with countdown element id="cd-<id>" */
function computePromoEndForDisplay(p){
  const now = new Date();
  // priority:
  // if tglPromoEnd exists -> use that date + jamPromoEnd(if exists) otherwise 23:59 of that date
  if(p.tglPromoEnd){
    const time = p.jamPromoEnd || '23:59';
    return new Date(p.tglPromoEnd + 'T' + time + ':00');
  }
  // else if tglPromoStart exists -> that date + jamPromoEnd or 23:59
  if(p.tglPromoStart){
    const time = p.jamPromoEnd || '23:59';
    return new Date(p.tglPromoStart + 'T' + time + ':00');
  }
  // else if only jamPromoEnd provided -> today at jamPromoEnd; if jam spans midnight and end < start, then if now <= end, end is today at end; otherwise, end = tomorrow at end
  if(p.jamPromoEnd){
    const endMin = minutesOf(p.jamPromoEnd);
    const startMin = minutesOf(p.jamPromoStart || '00:00');
    const nowMin = now.getHours()*60 + now.getMinutes();
    let end = new Date();
    end.setHours(Number(p.jamPromoEnd.split(':')[0]), Number(p.jamPromoEnd.split(':')[1]||0), 0, 0);
    if(startMin > endMin){
      // spans midnight
      // if nowMinutes <= endMin -> we are after midnight before end -> end is today at end
      // else end is tomorrow at end
      if(nowMin > endMin && nowMin < startMin){
        // not in promo period actually, but return end tomorrow to show near-ending (edge case)
        end.setDate(end.getDate()+1);
      } else {
        if(nowMin > endMin) end.setDate(end.getDate()+1);
      }
    } else {
      // normal day window
      if(nowMin > endMin) end.setDate(end.getDate()+1); // next day's end
    }
    return end;
  }
  // fallback: no specific end -> show generic
  return null;
}
function updateAllCountdowns(){
  (window.PRODUCTS || []).forEach(p=>{
    const el = document.getElementById('cd-'+p.id);
    if(!el) return;
    if(!isInPromo(p)){ el.style.display='none'; return; }
    const end = computePromoEndForDisplay(p);
    if(!end){ el.textContent = 'Promo aktif'; return; }
    const diff = end - new Date();
    if(diff <= 0){ el.textContent = 'Promo berakhir'; return; }
    const days = Math.floor(diff / (24*3600*1000));
    const hours = Math.floor(diff % (24*3600*1000) / 3600000);
    const mins = Math.floor(diff % 3600000 / 60000);
    el.style.display = 'block';
    el.textContent = days>0 ? `Berakhir dalam ${days}h ${hours}j ${mins}m` : `Berakhir dalam ${hours}j ${mins}m`;
  });
}

/* ----------------------
   RENDER PRODUCTS (with promo logic)
   ---------------------- */
function renderProducts(){
  const grid = $('#productsGrid');
  grid.innerHTML = '';
  (window.PRODUCTS || []).forEach(p=>{
    const inPromo = isInPromo(p);
    const card = document.createElement('article'); card.className = 'card';
    card.innerHTML = `
      <div style="position:relative">
        <img src="${p.img}" alt="${p.name}" loading="lazy">
        ${inPromo ? `<div class="promo-label">PROMO</div>` : ''}
      </div>
      <h3>${p.name}</h3>
      <p>${p.desc}</p>
      <div class="price-row">
        ${p.oldPrice ? `<span class="price-old">Rp ${Number(p.oldPrice).toLocaleString('id-ID')}</span>` : ''}
        <span class="price-new">Rp ${Number(p.price).toLocaleString('id-ID')}</span>
      </div>
      ${inPromo ? `<div class="countdown-overlay" id="cd-${p.id}">Memuat...</div>` : ''}
    `;
    grid.appendChild(card);
  });
  // Immediately update countdowns and set interval
  updateAllCountdowns();
  if(window._promoInterval) clearInterval(window._promoInterval);
  window._promoInterval = setInterval(updateAllCountdowns, 30000); // update per 30s
}

/* ----------------------
   GALLERY slider + lightbox (buttons + swipe)
   ---------------------- */
let galleryIndex = 0, galleryImgs = [];
function renderGallery(){
  const gallery = window.GALLERY || [];
  const track = $('#galleryTrack');
  galleryImgs = gallery.map(g => g.src);
  track.innerHTML = '';
  if(!gallery.length) { track.innerHTML = '<div style="padding:12px">Tidak ada gambar</div>'; return; }
  // render slides (single group; we'll manage index & wrap)
  gallery.forEach((g,i)=>{
    const el = document.createElement('div'); el.className = 'gallery-slide';
    el.innerHTML = `<img src="${g.src}" alt="${g.alt||''}" loading="lazy" data-idx="${i}">`;
    el.querySelector('img').addEventListener('click', ()=> openLightbox(i));
    track.appendChild(el);
  });
  galleryIndex = 0;
  updateGalleryTransform();
}
function updateGalleryTransform(){
  const track = $('#galleryTrack');
  const child = track.querySelector('.gallery-slide');
  if(!child) return;
  const slideW = child.offsetWidth + 16; // margin
  track.style.transform = `translateX(-${galleryIndex * slideW}px)`;
}
function galleryPrev(){ const track = $('#galleryTrack'); galleryIndex = (galleryIndex - 1 + track.children.length) % track.children.length; updateGalleryTransform(); }
function galleryNext(){ const track = $('#galleryTrack'); galleryIndex = (galleryIndex + 1) % track.children.length; updateGalleryTransform(); }

/* Lightbox controls */
let lbIndex = 0;
function openLightbox(i){
  lbIndex = i;
  $('#lightboxImg').src = galleryImgs[lbIndex];
  $('#lightbox').style.display = 'flex';
  $('#lightbox').setAttribute('aria-hidden','false');
}
function closeLightbox(){ $('#lightbox').style.display = 'none'; $('#lightbox').setAttribute('aria-hidden','true'); }
function lightboxPrev(){ lbIndex = (lbIndex - 1 + galleryImgs.length) % galleryImgs.length; $('#lightboxImg').src = galleryImgs[lbIndex]; }
function lightboxNext(){ lbIndex = (lbIndex + 1) % galleryImgs.length; $('#lightboxImg').src = galleryImgs[lbIndex]; }

/* enable swipe on gallery track */
function enableSwipe(el, prevFn, nextFn){
  if(!el) return;
  let startX=0, dx=0, isDown=false;
  el.addEventListener('touchstart', (e)=>{ isDown=true; startX = e.touches[0].clientX; });
  el.addEventListener('touchmove', (e)=>{ if(!isDown) return; dx = e.touches[0].clientX - startX; });
  el.addEventListener('touchend', ()=>{ if(!isDown) return; isDown=false; if(Math.abs(dx) > 40){ if(dx>0) prevFn(); else nextFn(); } dx=0; });
}
enableSwipe(document.getElementById('galleryTrack'), galleryPrev, galleryNext);

/* ----------------------
   TESTIMONIAL slider
   ---------------------- */
let testiIndex = 0, testiTimer = null;
function renderTestimonials(){
  const t = window.TESTIMONIALS || [];
  const track = $('#testiTrack');
  track.innerHTML = '';
  if(!t.length){ track.innerHTML = '<div style="padding:12px">Belum ada testimoni</div>'; return; }
  t.forEach((p)=>{
    const el = document.createElement('div'); el.className = 'testimonial-card';
    el.innerHTML = `<img src="${p.img}" alt="${p.name}" loading="lazy"><h4 style="margin:8px 0 6px 0">${p.name}${p.kota? ', '+p.kota: ''}</h4><p style="color:var(--muted)">${p.text}</p>`;
    track.appendChild(el);
  });
  testiIndex = 0;
  updateTestiTransform();
  if(testiTimer) clearInterval(testiTimer);
  testiTimer = setInterval(()=> testiNext(), 6000);
}
function updateTestiTransform(){
  const track = $('#testiTrack'); const card = track.querySelector('.testimonial-card');
  if(!card) return;
  const w = card.offsetWidth + 16;
  track.style.transform = `translateX(-${testiIndex * w}px)`;
}
function testiNext(){ const track = $('#testiTrack'); if(!track.children.length) return; testiIndex = (testiIndex + 1) % track.children.length; updateTestiTransform(); }
function testiPrev(){ const track = $('#testiTrack'); if(!track.children.length) return; testiIndex = (testiIndex - 1 + track.children.length) % track.children.length; updateTestiTransform(); }
enableSwipe(document.getElementById('testiTrack'), testiPrev, testiNext);

/* ----------------------
   Quick Order form behaviors
   ---------------------- */
function populateQuickProducts(){
  const sel = $('#qProduct'); sel.innerHTML = '<option value="">Pilih produk...</option>';
  (window.PRODUCTS || []).forEach(p=>{
    sel.insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name} ‚Äî Rp ${Number(p.price).toLocaleString('id-ID')}</option>`);
  });
}
function submitQuickOrder(e){
  e.preventDefault();
  const name = $('#qName').value.trim();
  const wa = $('#qWA').value.trim();
  const addr = $('#qAddr').value.trim();
  const pid = $('#qProduct').value;
  const qty = Number($('#qQty').value) || 1;
  const note = $('#qNote').value.trim();
  if(!pid){ alert('Pilih produk'); return; }
  const product = (window.PRODUCTS||[]).find(x=>x.id===pid);
  const subtotal = product ? product.price * qty : 0;
  const waNum = window._SITE_WA || '6281234567890';
  const text = `Halo, saya ${name} ingin memesan:%0A- ${product.name} x ${qty} = Rp ${subtotal.toLocaleString('id-ID')}%0AAlamat: ${addr}%0ANo WA pembeli: ${wa}%0ANote: ${note||'-'}%0A(Total belum termasuk ongkir)`;
  window.open('https://wa.me/' + waNum + '?text=' + encodeURIComponent(text));
}

/* ----------------------
   Misc: IG/YouTube render and init
   ---------------------- */
function renderFeed(){
  // IG: just show embed hint or provided URL (window.IG_URLS)
  const ig = window.IG_URLS || [];
  const igWrap = $('#igEmbedContainer');
  igWrap.innerHTML = '';
  if(!ig.length){
    igWrap.innerHTML = `<div style="padding:12px;color:var(--muted)">Tambahkan URL embed Instagram di data.js (IG_URLS)</div>`;
  } else {
    // show first embed link as anchor (real embed requires Instagram script)
    const a = document.createElement('a'); a.href = ig[0].replace('/embed',''); a.target='_blank'; a.textContent = 'Lihat posting Instagram';
    igWrap.appendChild(a);
  }
  // YouTube: use first id if provided
  if(window.YT_EMBED){
    $('#ytFrame').src = window.YT_EMBED;
  } else if(window.YT_ID){
    $('#ytFrame').src = `https://www.youtube.com/embed/${window.YT_ID}`;
  } else {
    $('#ytFrame').src = '';
  }
}

/* ----------------------
   INIT
   ---------------------- */
document.addEventListener('DOMContentLoaded', ()=>{
  applySiteMeta();
  renderHero();
  renderProducts();
  renderGallery();
  renderTestimonials();
  populateQuickProducts();
  renderFeed();
  // update transforms after layout
  setTimeout(()=>{ updateGalleryTransform(); updateTestiTransform(); }, 300);
  // ensure countdowns tick
  updateAllCountdowns();
});

/* responsiveness: update transform on resize */
window.addEventListener('resize', ()=>{ updateGalleryTransform(); updateTestiTransform(); });

/* small helper: toggle menu (if later used) */
function toggleMenu(){ const nav = document.querySelector('nav'); nav.classList.toggle('open'); }

/* Keyboard: close lightbox ESC */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') closeLightbox();
  if(e.key === 'ArrowLeft') lightboxPrev();
  if(e.key === 'ArrowRight') lightboxNext();
});

</script>
</body>
</html>
