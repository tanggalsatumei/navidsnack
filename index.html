<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Navid Snack — Camilan Sehat & Lezat Lamongan</title>
<meta name="description" content="Navid Snack - Camilan sehat & lezat dari Lamongan. Pesan cepat via WhatsApp. Halal, higienis, bergizi."/>
<meta name="keywords" content="navid snack, camilan lamongan, keripik pisang, kacang gurih, snack sehat"/>
<link rel="icon" href="https://img.icons8.com/emoji/48/popcorn.png" type="image/png"/>
<style>
:root{
  --bg:#fff;--surface:#fbfaf8;--muted:#7b7b7b;--text:#17202a;
  --brand:#0f1724;--accent:#ffb703;--accent-2:#fb8500;--soft:#f4f1ea;
  --success:#2d6a4f;--danger:#d00000;--glass:rgba(255,255,255,0.7);
  --radius:12px;--shadow:0 8px 24px rgba(17,24,39,0.08);--maxw:1200px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;line-height:1.45;
}

/* Dark mode overrides (toggle class on body) */
body.dark-mode{
  --bg:#071021;--surface:#0f1724;--muted:#9aa6b2;--text:#e6eef4;
  --brand:#071127;--accent:#ffb703;--accent-2:#ff9f1c;--soft:#081226;
}

/* Header */
header{position:sticky;top:0;z-index:1200;background:linear-gradient(180deg,var(--brand),#0b1220);color:var(--accent);padding:12px 20px;display:flex;align-items:center;gap:16px;box-shadow:0 2px 8px rgba(2,6,23,0.15)}
.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:18px}
.logo img{width:36px;height:36px;border-radius:8px;background:var(--soft);padding:4px}
nav{margin-left:auto;display:flex;align-items:center;gap:16px}
nav ul{display:flex;gap:16px;margin:0;padding:0;list-style:none}
nav a{color:var(--accent);text-decoration:none;font-weight:600}
.menu-toggle{display:none;background:none;border:1px solid rgba(255,183,3,0.12);color:var(--accent);padding:8px;border-radius:8px;cursor:pointer}
.btn-toggle{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--accent);padding:8px 10px;border-radius:10px;cursor:pointer}

/* Side menu (mobile) */
.side-menu{position:fixed;top:0;left:-100%;width:78%;height:100%;background:var(--brand);color:var(--accent);padding:22px;transition:left .28s;z-index:1300;overflow:auto}
.side-menu.active{left:0}
.side-menu .close-btn{background:none;border:none;color:var(--accent);font-size:28px;position:absolute;top:12px;right:18px;cursor:pointer}
.side-menu ul{list-style:none;padding:40px 0 0 0;margin:0}
.side-menu li{margin:14px 0}

/* hero */
#hero{position:relative;height:70vh;min-height:360px;overflow:hidden;border-bottom:1px solid rgba(15,23,36,0.06)}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .6s}
.slide.active{opacity:1}
.slide::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.35),rgba(2,6,23,0.12))}
.slide-content{position:relative;z-index:2;max-width:var(--maxw);margin:0 auto;padding:28px;color:var(--accent);display:flex;gap:24px;align-items:center;justify-content:center}
.slide-text h1{margin:0;font-size:34px;color:#fff}
.btn{background:var(--accent);color:var(--brand);border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(251,133,0,0.12)}
.dots{position:absolute;bottom:18px;width:100%;text-align:center;z-index:3}
.dot{display:inline-block;width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.6);margin:0 6px;cursor:pointer;opacity:.7}
.dot.active{background:var(--accent-2);opacity:1}
.arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.35);border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:20px}
.arrow-left{left:18px}.arrow-right{right:18px}

/* layout & cards */
.container{max-width:var(--maxw);margin:0 auto;padding:28px}
.section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px}
.card{background:var(--surface);padding:14px;border-radius:12px;box-shadow:var(--shadow);position:relative;overflow:visible;border:1px solid rgba(2,6,23,0.04)}
.img-wrapper{position:relative;border-radius:10px;overflow:hidden}
.card img{display:block;width:100%;height:220px;object-fit:cover;cursor:pointer}
.promo-label{position:absolute;top:12px;left:12px;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#fff;padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px;z-index:5}
.countdown-overlay{position:absolute;left:0;right:0;bottom:0;background:rgba(255,183,3,0.95);color:#071123;padding:6px 8px;border-bottom-left-radius:10px;border-bottom-right-radius:10px;font-weight:700;font-size:13px;text-align:center;z-index:6}
.price-row{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0}
.price-old{text-decoration:line-through;color:var(--muted);font-size:13px}
.price-new{color:var(--danger);font-weight:800}
.stars{color:#f6c453;margin-bottom:8px}

/* gallery */
.gallery-grid{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
.gallery-card{width:180px;border-radius:12px;overflow:hidden;box-shadow:var(--shadow);cursor:pointer;background:#fff}
.gallery-card img{width:100%;height:240px;object-fit:cover;display:block;transition:transform .25s}
.gallery-card:hover img{transform:scale(1.05)}

/* lightbox */
.lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,0.85);z-index:1400}
.lightbox img{max-width:92%;max-height:86%;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.6)}
.lightbox .close-light{position:absolute;top:18px;right:28px;color:#fff;font-size:28px;cursor:pointer}
.lightbox .nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:none;border:none;color:#fff;font-size:40px;padding:8px;cursor:pointer}
.lightbox .prev{left:12px}.lightbox .next{right:12px}

/* testimonial */
.testimonial-wrap{position:relative;padding:14px;background:linear-gradient(180deg,#fff,#fbfbfb);border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
.testimonial-slider{display:flex;transition:transform .45s ease}
.testimonial-card{min-width:300px;padding:16px;text-align:center}
.testimonial-card img{width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:12px}

/* cart & floats */
.whatsapp-float{position:fixed;bottom:18px;right:18px;z-index:1300}
.whatsapp-float a img{width:56px;height:56px;border-radius:12px;box-shadow:0 8px 22px rgba(11,18,32,0.15)}
/* floating cart hidden by default; shown when user adds item */
.floating-cart{position:fixed;bottom:86px;right:26px;z-index:1301;background:var(--accent);width:56px;height:56px;border-radius:14px;display:none;align-items:center;justify-content:center;font-weight:800;color:var(--brand);cursor:pointer;box-shadow:0 10px 30px rgba(15,23,36,0.12)}
.cart-badge{position:absolute;top:-8px;right:-8px;background:var(--danger);color:#fff;padding:4px 7px;border-radius:999px;font-size:12px}
.cart-panel{position:fixed;top:0;right:-420px;width:380px;height:100%;background:var(--bg);box-shadow:-20px 0 40px rgba(2,6,23,0.12);transition:right .35s;padding:20px;z-index:1350;overflow:auto}
.cart-panel.active{right:0}
.close-cart{position:absolute;top:12px;right:16px;font-size:22px;cursor:pointer}

/* quick order */
.quick-order{display:flex;flex-direction:column;gap:10px;padding:14px;background:var(--surface);border-radius:12px;box-shadow:var(--shadow)}
.quick-order input,.quick-order textarea,.quick-order select{padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);font-size:14px}
.quick-order button{align-self:flex-start}

/* footer */
footer{background:#08101a;color:#fff;padding:28px 20px;margin-top:40px}
.footer-grid{display:flex;gap:20px;flex-wrap:wrap;max-width:var(--maxw);margin:0 auto}
.footer-info{flex:1 1 320px}
.footer-map{flex:1 1 320px}

/* misc */
.promo-marquee{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#071123;padding:8px;text-align:center;font-weight:800}
.toast{position:fixed;left:18px;bottom:26px;background:rgba(3,7,18,0.95);color:#fff;padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);z-index:1450;display:flex;gap:10px;align-items:center}
.scroll-top{position:fixed;right:18px;bottom:160px;background:transparent;border:1px solid rgba(2,6,23,0.06);padding:8px;border-radius:10px;cursor:pointer;display:none;z-index:1302}

@media(max-width:900px){
  .slide-content{flex-direction:column;text-align:center}
  .slide-content img{width:160px;height:160px}
  .menu-toggle{display:inline-block}
  nav ul{display:none}
}
</style>
</head>
<body>
<!-- promo -->
<div class="promo-marquee" id="promoBar"><marquee behavior="scroll" direction="left">🔥 FLASH SALE Hari ini — Tersisa 3 item lagi! 🔥</marquee></div>

<!-- header -->
<header>
  <button class="menu-toggle" onclick="toggleMenu()" aria-label="Buka menu">☰</button>
  <div class="logo"><img src="https://img.icons8.com/emoji/48/popcorn.png" alt="Navid Snack logo"/><span>Navid Snack</span></div>
  <nav>
    <ul>
      <li><a href="#hero">Beranda</a></li>
      <li><a href="#products">Produk</a></li>
      <li><a href="#gallery">Galeri</a></li>
      <li><a href="#testimonials">Testimoni</a></li>
      <li><a href="#feed">Feed</a></li>
      <li><a href="#contact">Kontak</a></li>
    </ul>
  </nav>
  <button class="btn-toggle" onclick="toggleDarkMode()" aria-pressed="false" title="Toggle dark mode">🌙</button>
</header>

<!-- side menu -->
<div id="sideMenu" class="side-menu" aria-hidden="true">
  <button class="close-btn" onclick="toggleMenu()" aria-label="Tutup">×</button>
  <ul>
    <li><a href="#hero" onclick="toggleMenu()">Beranda</a></li>
    <li><a href="#products" onclick="toggleMenu()">Produk</a></li>
    <li><a href="#gallery" onclick="toggleMenu()">Galeri</a></li>
    <li><a href="#testimonials" onclick="toggleMenu()">Testimoni</a></li>
    <li><a href="#feed" onclick="toggleMenu()">Feed</a></li>
    <li><a href="#contact" onclick="toggleMenu()">Kontak</a></li>
  </ul>
</div>

<!-- HERO -->
<section id="hero">
  <button class="arrow arrow-left" onclick="prevSlide()" aria-label="Sebelumnya">❮</button>
  <button class="arrow arrow-right" onclick="nextSlide()" aria-label="Berikutnya">❯</button>

  <div class="slide active" style="background-image:url('assets/hero1.jpg')" role="img" aria-label="Navid Snack hero image">
    <div class="slide-content">
      <img src="assets/hero-prod1.jpg" alt="Navid Snack product"/>
      <div class="slide-text">
        <h1>Navid Snack — Camilan Sehat & Lezat</h1>
        <p>Snack khas Lamongan, dibuat higienis dan rasa yang konsisten. Pesan langsung via WhatsApp — cepat & mudah.</p>
        <div class="hero-cta"><a href="https://wa.me/6281234567890" class="btn" aria-label="Hubungi via WhatsApp">Hubungi Sekarang</a></div>
      </div>
    </div>
  </div>

  <div class="slide" style="background-image:url('assets/hero2.jpg')">
    <div class="slide-content">
      <img src="assets/hero-prod2.jpg" alt="Promo Navid Snack"/>
      <div class="slide-text">
        <h1>Promo Spesial Mingguan</h1>
        <p>Diskon paket & pengiriman cepat untuk area Deket, Lamongan.</p>
        <a href="#products" class="btn">Lihat Produk</a>
      </div>
    </div>
  </div>

  <div class="dots">
    <span class="dot active" onclick="showSlide(0)"></span>
    <span class="dot" onclick="showSlide(1)"></span>
  </div>
</section>

<!-- PRODUCTS -->
<section id="products" class="container" aria-labelledby="productsTitle">
  <div class="section-title"><h2 id="productsTitle">Produk Unggulan</h2></div>
  <div class="products-grid" id="productsGrid">
    <!-- Card 1 (promo: true) -->
    <article class="card" data-name="Keripik Pisang" data-price="15000" data-oldprice="20000" data-stock="3" data-promo="true" data-desc="Keripik pisang renyah khas Navid Snack" data-img="assets/keripik.jpg" aria-label="Keripik Pisang">
      <div class="img-wrapper">
        <img src="assets/keripik.jpg" alt="Keripik Pisang Navid Snack" onclick="openProductModal(this)">
        <div class="promo-label">PROMO</div>
        <div class="countdown-overlay" data-cid>Promo sampai 11:00</div>
      </div>
      <h3>Keripik Pisang</h3>
      <div class="price-row">
        <span class="price-old">Rp 20.000</span>
        <span class="price-new">Rp 15.000</span>
      </div>
      <div class="stars" aria-hidden="true">★★★★★</div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:center;align-items:center">
        <button class="btn" onclick="addToCart(this)">Tambah ke Keranjang</button>
        <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--brand)" onclick="quickOrderPref('Keripik Pisang',15000)">Pesan Cepat</button>
      </div>
    </article>

    <!-- Card 2 (promo: false) -->
    <article class="card" data-name="Kacang Gurih" data-price="22000" data-stock="8" data-promo="false" data-desc="Kacang gurih renyah" data-img="assets/kacang.jpg" aria-label="Kacang Gurih">
      <div class="img-wrapper">
        <img src="assets/kacang.jpg" alt="Kacang Gurih Navid Snack" onclick="openProductModal(this)">
        <!-- countdown-overlay absent when no promo -->
      </div>
      <h3>Kacang Gurih</h3>
      <div class="price-row">
        <!-- price-old will be hidden by JS if not promo -->
        <span class="price-old">Rp 25.000</span>
        <span class="price-new">Rp 22.000</span>
      </div>
      <div class="stars">★★★★★</div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
        <button class="btn" onclick="addToCart(this)">Tambah ke Keranjang</button>
        <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--brand)" onclick="quickOrderPref('Kacang Gurih',22000)">Pesan Cepat</button>
      </div>
    </article>
  </div>
</section>

<!-- GALLERY -->
<section id="gallery" class="container" aria-labelledby="galleryTitle">
  <div class="section-title"><h2 id="galleryTitle">Galeri Produk</h2></div>
  <div class="gallery-grid" id="galleryGrid">
    <div class="gallery-card"><img src="assets/g1.jpg" alt="Galeri 1" onclick="openLightboxByIndex(0)"></div>
    <div class="gallery-card"><img src="assets/g2.jpg" alt="Galeri 2" onclick="openLightboxByIndex(1)"></div>
    <div class="gallery-card"><img src="assets/g3.jpg" alt="Galeri 3" onclick="openLightboxByIndex(2)"></div>
  </div>
</section>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
  <button class="nav-btn prev" onclick="prevGallery()" aria-label="Sebelumnya">❮</button>
  <img id="lightboxImg" alt="Preview"/>
  <button class="nav-btn next" onclick="nextGallery()" aria-label="Berikutnya">❯</button>
  <button class="close-light" onclick="closeLightbox()" aria-label="Tutup">×</button>
</div>

<!-- TESTIMONIAL -->
<section id="testimonials" class="container" aria-labelledby="testiTitle">
  <div class="section-title"><h2 id="testiTitle">Testimoni Pelanggan</h2></div>
  <div class="testimonial-wrap">
    <div style="overflow:hidden">
      <div id="testiSlider" class="testimonial-slider">
        <div class="testimonial-card"><img src="https://i.pravatar.cc/100?u=a" alt="Foto pelanggan A"/><p><strong>Ani, Surabaya</strong></p><p>"Rasanya enak, pengirimannya cepat. Recomended!"</p></div>
        <div class="testimonial-card"><img src="https://i.pravatar.cc/100?u=b" alt="Foto pelanggan B"/><p><strong>Budi, Gresik</strong></p><p>"Camilan keluarga favorit, gurih dan renyah."</p></div>
        <div class="testimonial-card"><img src="https://i.pravatar.cc/100?u=c" alt="Foto pelanggan C"/><p><strong>Siti, Lamongan</strong></p><p>"Pesan online mudah, respon WA cepat."</p></div>
      </div>
    </div>
    <div class="testimonial-nav" style="margin-top:12px">
      <button class="btn" onclick="testiPrev()">❮</button>
      <button class="btn" onclick="testiNext()">❯</button>
    </div>
  </div>
</section>

<!-- QUICK ORDER FORM -->
<section class="container" aria-labelledby="quickOrderTitle" style="margin-top:18px">
  <div class="section-title"><h2 id="quickOrderTitle">Form Pemesanan Cepat</h2></div>
  <form id="quickOrderForm" class="quick-order" onsubmit="submitQuickOrder(event)">
    <input id="qName" type="text" placeholder="Nama lengkap" required aria-label="Nama"/>
    <input id="qWA" type="tel" placeholder="Nomor WhatsApp (contoh: 0812...)" required aria-label="Nomor WA"/>
    <input id="qAddr" type="text" placeholder="Alamat (kelurahan/kota)" required aria-label="Alamat"/>
    <select id="qProduct" required aria-label="Pilih produk">
      <option value="">Pilih produk...</option>
      <option value="Keripik Pisang|15000">Keripik Pisang - Rp15.000</option>
      <option value="Kacang Gurih|22000">Kacang Gurih - Rp22.000</option>
    </select>
    <input id="qQty" type="number" min="1" value="1" required aria-label="Jumlah"/>
    <textarea id="qNote" rows="2" placeholder="Catatan / request (opsional)"></textarea>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="btn" type="submit">Kirim ke WhatsApp Admin</button>
      <small style="color:var(--muted)">Subtotal akan disertakan sebelum ongkir</small>
    </div>
  </form>
</section>

<!-- floating elements -->
<button class="floating-cart" id="floatingCart" onclick="toggleCart()" aria-label="Buka keranjang">🛒<span class="cart-badge" id="cartBadge">0</span></button>
<div class="whatsapp-float" title="Chat via WhatsApp"><a id="waLink" href="https://wa.me/6281234567890" target="_blank" rel="noreferrer"><img src="https://img.icons8.com/color/96/whatsapp.png" alt="WhatsApp Navid Snack"/></a></div>
<button class="scroll-top" id="scrollTopBtn" onclick="scrollToTop()" aria-label="Kembali ke atas">↑</button>

<!-- cart panel -->
<aside id="cartPanel" class="cart-panel" aria-label="Keranjang belanja">
  <button class="close-cart" onclick="toggleCart()">×</button>
  <h3>Keranjang</h3>
  <div id="cartItems" style="margin-top:14px"></div>
  <p style="margin-top:12px"><strong>Subtotal:</strong> Rp <span id="cartTotal">0</span></p>
  <p style="font-size:13px;color:var(--muted)">Belum termasuk ongkir dari Deket, Lamongan</p>
  <div style="display:flex;gap:8px;margin-top:12px">
    <button class="btn" onclick="checkout()">Checkout via WhatsApp</button>
    <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="clearCart()">Bersihkan</button>
  </div>
</aside>

<!-- product modal -->
<div id="productModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1500">
  <div style="background:var(--bg);padding:18px;border-radius:10px;max-width:520px;width:calc(100% - 40px);position:relative">
    <button onclick="closeProductModal()" style="position:absolute;top:10px;right:12px;background:none;border:none;font-size:22px;cursor:pointer">×</button>
    <img id="modalImg" src="" alt="Detail produk" style="width:100%;height:300px;object-fit:cover;border-radius:8px;margin-bottom:10px">
    <h3 id="modalName"></h3>
    <p id="modalDesc" style="color:var(--muted)"></p>
    <p id="modalPrice" style="font-weight:800;color:var(--danger)"></p>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" onclick="addToCartFromModal()">Tambah ke Keranjang</button>
      <button class="btn" style="background:transparent;border:1px solid rgba(2,6,23,0.06)" onclick="closeProductModal()">Tutup</button>
    </div>
  </div>
</div>

<!-- feed (instagram embed) -->
<section id="feed" class="container" aria-labelledby="feedTitle">
  <div class="section-title"><h2 id="feedTitle">Feed Instagram</h2></div>
  <div id="igEmbedWrap" style="display:flex;justify-content:center">
    <!-- We'll inject a single embedded post (acak). 
         Replace the sample strings in igUrls[] below with real embed URLs from your account:
         Example embed URL format: https://www.instagram.com/p/POST_ID/embed
         Instagram requires their embed script to render blockquote/embed.
    -->
    <div id="igEmbedContainer"></div>
  </div>
</section>

<!-- footer -->
<footer id="contact">
  <div class="footer-grid">
    <div class="footer-info">
      <h3>Navid Snack</h3>
      <p>Alamat: Deket, Lamongan, Jawa Timur</p>
      <p>Telp: +62 812-3456-7890</p>
      <p style="margin-top:8px"><strong>Certificate:</strong></p>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <img src="https://via.placeholder.com/80x40?text=Halal" alt="Sertifikat Halal" style="height:40px;border-radius:6px"/>
        <img src="https://via.placeholder.com/80x40?text=BPOM" alt="Sertifikat BPOM" style="height:40px;border-radius:6px"/>
      </div>
    </div>
    <div class="footer-map">
      <h4>Lokasi</h4>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!..." style="width:100%;height:220px;border:0;border-radius:10px" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="Lokasi Navid Snack"></iframe>
    </div>
  </div>
</footer>

<!-- toast placeholder -->
<div id="toastPlace"></div>

<!-- Instagram embed script (official) -->
<script async defer src="//www.instagram.com/embed.js"></script>

<script>
/* -------------------------
   Simple helper functions
   -------------------------*/
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));

/* ====== HERO SLIDER ====== */
let slides = $$('.slide'), dots = $$('.dot'), slideCur = 0;
function showSlide(n){
  slideCur = (n+slides.length)%slides.length;
  slides.forEach((s,i)=>s.classList.toggle('active', i===slideCur));
  dots.forEach((d,i)=>d.classList.toggle('active', i===slideCur));
}
function nextSlide(){ showSlide(slideCur+1) }
function prevSlide(){ showSlide(slideCur-1) }
let slideTimer = setInterval(nextSlide, 6000);

/* ====== SIDE MENU (HAMBURGER) ====== */
function toggleMenu(){
  const menu = $('#sideMenu');
  const isActive = menu.classList.toggle('active');
  menu.setAttribute('aria-hidden', !isActive);
}
/* hide side menu when clicking outside (optional) */
document.addEventListener('click', (e)=>{
  const side = $('#sideMenu');
  const btn = e.target.closest('.menu-toggle')!==null;
  if(!btn && side.classList.contains('active') && !e.target.closest('.side-menu')) {
    side.classList.remove('active');
    side.setAttribute('aria-hidden','true');
  }
});

/* ====== DARK MODE ====== */
function toggleDarkMode(){
  document.body.classList.toggle('dark-mode');
  const t = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
  $$('.btn-toggle').forEach(b=>b.textContent = t);
}

/* ====== PRODUCTS: handle promo/price & countdown position ====== */
function initProductCards(){
  $$('.card').forEach((card, idx) => {
    // ensure countdown inside image wrapper; we already placed it in HTML
    // Hide price-old if not promo
    const isPromo = card.dataset.promo === 'true' || card.classList.contains('promo');
    const oldEl = card.querySelector('.price-old');
    if(!isPromo && oldEl) {
      oldEl.style.display = 'none';
    }
    // If no promo and only price-new should show original price, ensure price-new shows data-price
    if(!isPromo){
      const priceNew = card.querySelector('.price-new');
      if(priceNew) priceNew.textContent = formatRupiah(card.dataset.price);
    } else {
      // If promo true but data-oldprice exists, format values
      if(card.dataset.oldprice){
        const old = card.querySelector('.price-old');
        const nw = card.querySelector('.price-new');
        if(old) old.textContent = formatRupiah(card.dataset.oldprice);
        if(nw) nw.textContent = formatRupiah(card.dataset.price);
      }
    }
    // If countdown present, you may implement live countdown based on data-start/data-end.
    const cd = card.querySelector('[data-cid]');
    if(cd && card.dataset.end){
      // simple static text or compute based on server time; here we keep the text as in HTML.
    }
  });
}
function formatRupiah(v){ if(!v) return ''; return 'Rp ' + Number(v).toLocaleString('id-ID'); }

/* ====== CART ====== */
let cart = []; // {name, price, qty, stock}
const floatingCartBtn = $('#floatingCart');
const cartBadge = $('#cartBadge');
const cartItemsWrap = $('#cartItems');
const cartTotalEl = $('#cartTotal');

function addToCart(btn){
  const card = btn.closest('.card');
  addProductToCartFromCard(card);
}
function addProductToCartFromCard(card){
  const name = card.dataset.name;
  const price = Number(card.dataset.price || 0);
  const stock = Number(card.dataset.stock || 999);
  let found = cart.find(x=>x.name===name);
  if(found){
    if(found.qty+1 > stock){ showToast('Stok tidak cukup untuk ' + name); return; }
    found.qty++;
  } else {
    cart.push({name, price, qty:1, stock});
  }
  renderCart();
  showToast(name + ' ditambahkan ke keranjang');
  // show floating cart when first item added
  floatingCartBtn.style.display = 'flex';
}
function addToCartFromModal(){
  const name = $('#modalName').textContent;
  const priceText = $('#modalPrice').getAttribute('data-price') || $('#modalPrice').textContent.replace(/[^0-9]/g,'') || 0;
  const price = Number(priceText);
  let found = cart.find(x=>x.name===name);
  if(found) found.qty++;
  else cart.push({name, price, qty:1, stock:99});
  renderCart();
  showToast(name + ' ditambahkan ke keranjang');
  floatingCartBtn.style.display = 'flex';
  closeProductModal();
}

function renderCart(){
  if(!cartItemsWrap) return;
  cartItemsWrap.innerHTML = '';
  let total = 0;
  cart.forEach((it, i) => {
    total += it.price * it.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.style.padding = '10px 0';
    div.innerHTML = `
      <strong>${it.name}</strong><div style="margin-top:6px">Rp ${it.price.toLocaleString('id-ID')} &nbsp;
      <button onclick="decQty(${i})">-</button>
      <input type="number" value="${it.qty}" min="1" style="width:56px" onchange="setQty(${i}, this.value)">
      <button onclick="incQty(${i})">+</button>
      &nbsp; = <strong>Rp ${(it.price*it.qty).toLocaleString('id-ID')}</strong>
      <button style="float:right;background:transparent;border:none;color:var(--danger);cursor:pointer" onclick="removeItem(${i})">Hapus</button>
      </div>
    `;
    cartItemsWrap.appendChild(div);
  });
  cartTotalEl.textContent = total.toLocaleString('id-ID');
  cartBadge.textContent = cart.reduce((s,i)=>s+i.qty,0);
}

function incQty(i){ if(cart[i].qty < cart[i].stock) cart[i].qty++; renderCart(); }
function decQty(i){ if(cart[i].qty > 1) cart[i].qty--; renderCart(); }
function setQty(i, val){ let q = Number(val); if(isNaN(q) || q<1) q=1; if(q>cart[i].stock){ showToast('Melebihi stok tersedia'); q = cart[i].stock; } cart[i].qty = q; renderCart(); }
function removeItem(i){ cart.splice(i,1); renderCart(); if(cart.length===0){ floatingCartBtn.style.display='none'; } }
function clearCart(){ cart=[]; renderCart(); toggleCart(); showToast('Keranjang dibersihkan'); floatingCartBtn.style.display='none'; }

function toggleCart(){ $('#cartPanel').classList.toggle('active'); }

/* ====== CHECKOUT via WA ====== */
function checkout(){
  if(cart.length===0){ showToast('Keranjang masih kosong'); return; }
  let msg = 'Halo, saya ingin pesan:%0A';
  let subtotal = 0;
  cart.forEach(it=>{
    msg += `${it.name} x ${it.qty} = Rp ${ (it.price*it.qty).toLocaleString('id-ID') }%0A`;
    subtotal += it.price * it.qty;
  });
  msg += `%0ASubtotal: Rp ${subtotal.toLocaleString('id-ID')} (belum termasuk ongkir dari Deket, Lamongan)`;
  window.open('https://wa.me/6281234567890?text=' + encodeURIComponent(msg));
}

/* ====== QUICK ORDER FORM ====== */
function quickOrderPref(name, price){
  $('#qProduct').value = `${name}|${price}`;
  $('#qQty').value = 1;
  $('#qName').focus();
  window.scrollTo({top:document.getElementById('quickOrderForm').offsetTop-80,behavior:'smooth'});
}
function submitQuickOrder(e){
  e.preventDefault();
  const name = $('#qName').value.trim(), wa = $('#qWA').value.trim(), addr = $('#qAddr').value.trim();
  const prod = $('#qProduct').value, qty = Number($('#qQty').value), note = $('#qNote').value;
  if(!prod){ showToast('Pilih produk'); return; }
  const [pname,pprice] = prod.split('|'); const subtotal = Number(pprice)*qty;
  let text = `Halo, saya *${name}* ingin memesan:%0A- ${pname} x ${qty} = Rp ${subtotal}%0AAlamat: ${addr}%0ANo WA: ${wa}%0ANote: ${note||'-'}%0A(Subtotal belum termasuk ongkir dari Deket, Lamongan)`;
  window.open('https://wa.me/6281234567890?text=' + encodeURIComponent(text));
}

/* ====== TOAST notification (e.g. simulated recent purchase) ====== */
function showToast(text, delay = 4000){
  const t = document.createElement('div'); t.className='toast';
  t.style.opacity = '1';
  t.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" style="opacity:.9;margin-right:8px"><circle cx="12" cy="12" r="10" fill="#ffcf6b"/></svg><div>${text}</div>`;
  $('#toastPlace').appendChild(t);
  setTimeout(()=>{ t.style.transition='opacity .5s'; t.style.opacity=0; t.addEventListener('transitionend', ()=>t.remove()); }, delay);
}
/* simulate sale notices */
const salesSamples=[['Budi','Surabaya','Keripik Pisang'],['Ani','Gresik','Kacang Gurih'],['Rina','Sidoarjo','Keripik Pisang']];
setInterval(()=>{ const s = salesSamples[Math.floor(Math.random()*salesSamples.length)]; showToast(`${s[0]} dari ${s[1]} baru saja membeli ${s[2]}`); }, 14000);

/* ====== GALLERY LIGHTBOX with navigation ====== */
const galleryImgs = ['assets/g1.jpg','assets/g2.jpg','assets/g3.jpg']; // update with your hosted images
let gIndex = 0;
function openLightboxByIndex(i){
  gIndex = i % galleryImgs.length;
  $('#lightboxImg').src = galleryImgs[gIndex];
  $('#lightbox').style.display = 'flex';
  $('#lightbox').setAttribute('aria-hidden','false');
}
function closeLightbox(){ $('#lightbox').style.display = 'none'; $('#lightbox').setAttribute('aria-hidden','true'); }
function nextGallery(){ gIndex = (gIndex+1) % galleryImgs.length; $('#lightboxImg').src = galleryImgs[gIndex]; }
function prevGallery(){ gIndex = (gIndex-1 + galleryImgs.length) % galleryImgs.length; $('#lightboxImg').src = galleryImgs[gIndex]; }

/* ====== TESTIMONIAL slider (looping) ====== */
let tIdx = 0; const tSlider = $('#testiSlider');
function testiNext(){ tIdx = (tIdx + 1) % tSlider.children.length; tSlider.style.transform = `translateX(-${tIdx * 300}px)`; }
function testiPrev(){ tIdx = (tIdx - 1 + tSlider.children.length) % tSlider.children.length; tSlider.style.transform = `translateX(-${tIdx * 300}px)`; }

/* ====== PRODUCT MODAL (detail from dataset) ====== */
function openProductModal(imgEl){
  const card = imgEl.closest('.card');
  $('#modalImg').src = card.dataset.img || imgEl.src;
  $('#modalName').textContent = card.dataset.name || '';
  $('#modalDesc').textContent = card.dataset.desc || '';
  const price = card.dataset.price || '';
  $('#modalPrice').textContent = price ? formatRupiah(price) : '';
  $('#modalPrice').setAttribute('data-price', price || '');
  $('#productModal').style.display = 'flex';
}
function closeProductModal(){ $('#productModal').style.display = 'none'; }

/* ====== INSTAGRAM embed (1 random post) ====== */
/* NOTE: Replace the sample entries with **actual embed URLs** from your account:
   Example: "https://www.instagram.com/p/POST_ID/embed"
   You can obtain embed code from Instagram >> three-dot >> Embed (copy).
*/
const igUrls = [
  // Put real embed URLs here for navid_snack posts:
  "https://www.instagram.com/p/CEXAMPLE1/embed",
  "https://www.instagram.com/p/CEXAMPLE2/embed",
  "https://www.instagram.com/p/CEXAMPLE3/embed"
];
// If there are real embed URLs, inject a blockquote so instagram's embed.js renders it.
(function renderRandomIG(){
  const container = $('#igEmbedContainer');
  if(!container) return;
  // choose random
  const url = igUrls[Math.floor(Math.random()*igUrls.length)];
  // if url is placeholder, show small note
  if(!url.includes('/p/')){
    container.innerHTML = `<div style="padding:20px;background:var(--surface);border-radius:8px">Silakan ganti array <code>igUrls</code> di script dengan URL embed post dari akun https://www.instagram.com/navid_snack/</div>`;
    return;
  }
  // create blockquote as Instagram expects
  const block = document.createElement('blockquote'); block.className = 'instagram-media'; block.setAttribute('data-instgrm-permalink', url.replace('/embed','')); block.style = "width:100%;max-width:540px";
  block.innerHTML = `<a href="${url.replace('/embed','')}" target="_blank" rel="noopener noreferrer">Lihat di Instagram</a>`;
  container.appendChild(block);
  if(window.instgrm && window.instgrm.Embeds && typeof window.instgrm.Embeds.process === 'function'){
    try{ window.instgrm.Embeds.process(); }catch(e){ /* ignore */ }
  }
})();

/* ====== helpers & init ====== */
function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}); }
window.addEventListener('scroll', ()=>{ $('#scrollTopBtn').style.display = (window.scrollY>200)?'inline-block':'none'; });

/* Hide price-old for non-promo cards and initialize countdown placement */
document.addEventListener('DOMContentLoaded', ()=>{
  initProductCards();
  renderCart();
  // ensure floating cart hidden if empty
  if(cart.length===0) floatingCartBtn.style.display = 'none';
});

/* Accessibility: ESC to close modals/side menu */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    closeLightbox();
    closeProductModal();
    $('#sideMenu').classList.remove('active');
  }
});
</script>
</body>
</html>
